diff --git a/backend/api/invoices.py b/backend/api/invoices.py
index 6f2360d..f9de658 100644
--- a/backend/api/invoices.py
+++ b/backend/api/invoices.py
@@ -26,12 +26,18 @@ from backend.services import invoices as invoices_service
 from core.invoice_extractor import extract_text_from_file
 from backend.dependencies.tenant import Tenant, get_current_tenant
 
+MULTIPART_AVAILABLE = False
 try:  # pragma: no cover
     import python_multipart  # type: ignore  # noqa: F401
 
     MULTIPART_AVAILABLE = True
 except ImportError:  # pragma: no cover
-    MULTIPART_AVAILABLE = False
+    try:
+        import multipart  # type: ignore  # noqa: F401
+
+        MULTIPART_AVAILABLE = True
+    except ImportError:
+        MULTIPART_AVAILABLE = False
 
 LOGGER = logging.getLogger(__name__)
 
@@ -256,7 +262,7 @@ def get_invoice_history(
     invoice_id: str | None = None,
     date_start: str | None = None,
     date_end: str | None = None,
-    limit: int = 100,
+    limit: int = 5000,
     tenant: Tenant = Depends(get_current_tenant),
 ):
     entries = invoices_service.list_processed_invoices(
diff --git a/backend/api/prices.py b/backend/api/prices.py
index 3dc669b..3d484eb 100644
--- a/backend/api/prices.py
+++ b/backend/api/prices.py
@@ -3,6 +3,7 @@
 from __future__ import annotations
 
 from datetime import datetime
+import json
 from typing import Optional
 
 from fastapi import APIRouter, Depends, Query
@@ -39,7 +40,8 @@ def get_price_history(
         return PriceHistoryResponse(items=[])
 
     df = df.replace({"": None})
-    items = df.to_dict(orient="records")
+    # Force sérialisation en types natifs (évite les pandas.Timestamp/numpy.* qui font planter Pydantic)
+    items = json.loads(df.to_json(orient="records", date_format="iso"))
     return PriceHistoryResponse(items=items)
 @router.get("/latest", response_model=LatestPriceResponse)
 def get_latest_price_history(
diff --git a/backend/main.py b/backend/main.py
index 1a93bcb..2b21e07 100644
--- a/backend/main.py
+++ b/backend/main.py
@@ -42,6 +42,16 @@ from backend.settings import Settings
 from core.user_service import bootstrap_users_if_enabled
 from core.products_loader import ensure_barcode_constraints
 
+# Couverture des origines locales courantes (Vite dev, conteneur Nginx front et fallback React).
+DEFAULT_DEV_ORIGINS = [
+    "http://localhost:5173",
+    "http://127.0.0.1:5173",
+    "http://localhost:5175",
+    "http://127.0.0.1:5175",
+    "http://localhost:3000",
+    "http://127.0.0.1:3000",
+]
+
 
 class ProductPayload(BaseModel):
     """Lightweight projection of a product for the SPA."""
@@ -134,8 +144,8 @@ def _compute_inventory_value(tenant_id: int) -> dict[str, float]:
 def _load_allowed_origins() -> list[str]:
     raw_origins = os.getenv("CORS_ALLOWED_ORIGINS")
     if not raw_origins:
-        # Vite/React dev server par défaut
-        return ["http://localhost:5173"]
+        # Vite/React dev server + conteneur frontend (5175) + fallback React (3000)
+        return DEFAULT_DEV_ORIGINS
 
     parsed: list[str] = []
     for entry in raw_origins.split(","):
@@ -143,7 +153,14 @@ def _load_allowed_origins() -> list[str]:
         if cleaned:
             parsed.append(cleaned)
     # Allow explicit wildcard only if set
-    return parsed or ["http://localhost:5173"]
+    return parsed or DEFAULT_DEV_ORIGINS
+
+
+def _sanitize_origins(origins: list[str] | None) -> list[str]:
+    if not origins:
+        return []
+    cleaned = [entry.strip() for entry in origins if entry and entry.strip()]
+    return cleaned
 
 
 @lru_cache
@@ -159,11 +176,11 @@ def create_app() -> FastAPI:
     bootstrap_users_if_enabled()
     ensure_barcode_constraints()
 
-    allowed_origins = settings.cors_allowed_origins or _load_allowed_origins()
+    allowed_origins = _sanitize_origins(settings.cors_allowed_origins) or _load_allowed_origins()
     app.add_middleware(
         CORSMiddleware,
         allow_origins=allowed_origins,
-        allow_credentials="*" not in allowed_origins,
+        allow_credentials="*" not in allowed_origins and bool(allowed_origins),
         allow_methods=["*"],
         allow_headers=["*"],
     )
diff --git a/backend/services/invoices.py b/backend/services/invoices.py
index 59c21c3..9676596 100644
--- a/backend/services/invoices.py
+++ b/backend/services/invoices.py
@@ -313,10 +313,10 @@ def list_processed_invoices(
     invoice_id: str | None = None,
     date_start: str | None = None,
     date_end: str | None = None,
-    limit: int = 100,
+    limit: int = 5000,
 ) -> list[dict[str, object]]:
     filters = ["tenant_id = :tenant_id"]
-    params: dict[str, object] = {"tenant_id": int(tenant_id), "limit": int(max(1, min(limit, 500)))}
+    params: dict[str, object] = {"tenant_id": int(tenant_id), "limit": int(max(1, min(limit, 5000)))}
 
     if supplier:
         filters.append("supplier ILIKE :supplier")
diff --git a/core/invoice_extractor.py b/core/invoice_extractor.py
index 4e6953d..f873e27 100644
--- a/core/invoice_extractor.py
+++ b/core/invoice_extractor.py
@@ -114,6 +114,8 @@ def detect_invoice_format(raw_text: str, supplier_hint: str | None = None) -> st
         if key in _PARSER_REGISTRY:  # Si parseur enregistré
             return key  # Utilise ce parseur
     lowered = (raw_text or "").lower()  # Texte en minuscules pour heuristiques
+    if "eurociel" in lowered:  # Détection Eurociel
+        return "eurociel"
     if "metro" in lowered:  # Détection Metro
         return "metro"
     if "pomona" in lowered or "passionfroid" in lowered:  # Détection Pomona
@@ -444,110 +446,88 @@ def _parse_detail_line(line: str) -> dict[str, object] | None:
 
 
 def _parse_inline_summary(label: str) -> dict[str, object] | None:
-    """Parse une ligne “compacte” (nom + bloc numérique en fin de ligne)."""  # Docstring parsing inline
-    tokens = _normalise_whitespace(label).split()  # Tokenise la ligne
-    if len(tokens) < 4:  # Trop court
-        return None  # Échec
-
-    tail_probe = _parse_detail_tail_tokens(tokens)  # Tente parsing queue numérique
-    if tail_probe:  # Si succès
-        detail, consumed = tail_probe  # Détail et tokens consommés
-        designation = " ".join(tokens[:-consumed]).strip()  # Reste = désignation
-        if designation:  # Si libellé non vide
-            detail["nom"] = designation  # Ajoute le nom
-            return detail  # Retourne le détail complet
-
-    tva_code = None  # Code TVA éventuel
-    if re.fullmatch(r"[A-Za-z]", tokens[-1]):  # Dernier token lettre
-        tva_code = tokens.pop().upper()  # Extrait code TVA
-
-    tail_values: list[float] = []  # Valeurs numériques extraites
-    tail_indices: list[int] = []  # Indices correspondants
-    idx = len(tokens) - 1  # Index de parcours inversé
-    while idx >= 0 and len(tail_values) < 4:  # Parcourt jusqu'à 4 valeurs
-        value = _parse_decimal(tokens[idx])  # Tente parse décimal
-        if value is None:  # Arrêt si non numérique
-            break
-        tail_values.append(value)  # Ajoute valeur
-        tail_indices.append(idx)  # Stocke l'indice
-        idx -= 1  # Décrémente l'index
-
-    if len(tail_values) < 2:  # Besoin au moins 2 valeurs (montant, quantité)
-        return None  # Échec
-
-    for remove_index in sorted(tail_indices, reverse=True):  # Supprime les tokens numériques identifiés
-        tokens.pop(remove_index)
-
-    montant_total = tail_values[0]  # Première valeur = montant total
-    quantity_value = tail_values[1]  # Deuxième = quantité
-    colisage_value = tail_values[2] if len(tail_values) >= 3 and len(tail_values) != 3 else None  # Colisage éventuel
-    unit_price_value = tail_values[3] if len(tail_values) == 4 else (
-        tail_values[2] if len(tail_values) == 3 else tail_values[1]
-    )  # Prix unitaire déduit
-
-    price = float(unit_price_value)  # Prix unitaire en float
-    quantity = _parse_int(str(quantity_value))  # Quantité en int
-
-    if quantity is None:  # Quantité invalide
-        return None  # Échec
-
-    colisage = _parse_int(str(colisage_value)) if colisage_value is not None else 1  # Colisage en int
-    if colisage is None or colisage <= 0:  # Si invalide
-        colisage = 1  # Fallback à 1
-
-    regie = None  # Régie éventuelle
-    volume = vap = poids = None  # Mesures éventuelles
-    regie_idx = len(tokens) - 1  # Index de recherche
-    regie_numbers: list[float] = []  # Valeurs numériques associées à la régie
-    probe_idx = regie_idx  # Position de sondage
-    while probe_idx >= 0 and len(regie_numbers) < 3:  # Parcours arrière pour récupérer volume/vap/poids
-        candidate_value = _parse_decimal(tokens[probe_idx])  # Valeur numérique potentielle
-        if candidate_value is None:  # Arrêt si non numérique
+    tokens = _normalise_whitespace(label).split()
+    if len(tokens) < 4:
+        return None
+
+    tail_probe = _parse_detail_tail_tokens(tokens)
+    if tail_probe:
+        detail, consumed = tail_probe
+        designation = " ".join(tokens[:-consumed]).strip()
+        if designation:
+            detail["nom"] = designation
+            return detail
+
+    tva_code = None
+    if re.fullmatch(r"[A-Za-z]", tokens[-1]):
+        tva_code = tokens.pop().upper()
+
+    working = tokens[:]
+
+    def _pop_numeric_from_end() -> float | None:
+        if not working:
+            return None
+        value = _parse_decimal(working[-1])
+        if value is None:
+            return None
+        working.pop()
+        return value
+
+    montant_total = _pop_numeric_from_end()
+    colisage_value = _pop_numeric_from_end()
+    quantity_value = _pop_numeric_from_end()
+    price_value = _pop_numeric_from_end()
+
+    if montant_total is None or price_value is None or quantity_value is None or colisage_value is None:
+        return None
+
+    quantity = _parse_int(str(quantity_value))
+    colisage = _parse_int(str(colisage_value)) or 1
+    if quantity is None:
+        return None
+
+    regie = None
+    volume = vap = poids = None
+    regie_numbers: list[float] = []
+    while working and _parse_decimal(working[-1]) is not None and len(regie_numbers) < 3:
+        numeric = _parse_decimal(working.pop())
+        if numeric is None:
             break
-        regie_numbers.append(candidate_value)  # Ajoute
-        probe_idx -= 1  # Recule d'un token
-    if (
-        probe_idx >= 0
-        and regie_numbers
-        and re.fullmatch(r"[A-Za-z]", tokens[probe_idx])
-    ):  # Si une lettre précède les valeurs
-        regie = tokens[probe_idx].upper()  # Régie détectée
-        tokens = tokens[:probe_idx]  # Tronque les tokens avant la régie
-        regie_numbers = list(reversed(regie_numbers))  # Remet les valeurs dans l'ordre
-        if regie_numbers:  # Affecte volume
+        regie_numbers.append(numeric)
+    if working and re.fullmatch(r"[A-Za-z]", working[-1]) and regie_numbers:
+        regie = working.pop().upper()
+        regie_numbers = list(reversed(regie_numbers))
+        if regie_numbers:
             volume = regie_numbers[0]
-        if len(regie_numbers) >= 2:  # Affecte vap
+        if len(regie_numbers) >= 2:
             vap = regie_numbers[1]
-        if len(regie_numbers) >= 3:  # Affecte poids
+        if len(regie_numbers) >= 3:
             poids = regie_numbers[2]
 
-    designation = " ".join(tokens).strip()  # Recompose la désignation
-    if not designation:  # Si vide
-        return None  # Échec
+    designation = " ".join(working).strip()
+    if not designation:
+        return None
 
     detail: dict[str, object] = {
         "nom": designation,
-        "prix_unitaire": round(price, 2),
+        "prix_unitaire": round(float(price_value), 2),
         "quantite_colis": max(quantity, 0),
-        "colisage": colisage,
-        "montant_total": round(
-            montant_total if montant_total is not None else price * max(quantity, 0) * colisage,
-            2,
-        ),
-    }  # Détail construit
-
-    if tva_code:  # Ajoute le code TVA si présent
+        "colisage": max(colisage, 1),
+        "montant_total": round(float(montant_total), 2),
+    }
+
+    if tva_code:
         detail["tva_code"] = tva_code
-    if regie:  # Ajoute la régie si trouvée
+    if regie:
         detail["regie"] = regie
-    if volume is not None:  # Ajoute volume
+    if volume is not None:
         detail["volume_litre"] = float(volume)
-    if vap is not None:  # Ajoute VAP
+    if vap is not None:
         detail["vap"] = float(vap)
-    if poids is not None:  # Ajoute poids
+    if poids is not None:
         detail["poids_unitaire"] = float(poids)
 
-    return detail  # Retourne le détail final
+    return detail
 
 
 def _join_designation(parts: Sequence[str]) -> str:
@@ -946,8 +926,137 @@ def extract_products_from_transgourmet_invoice(raw_product_text: str, *, margin_
     return extract_products_from_metro_invoice(normalized, margin_rate=margin_rate)  # Délègue au parseur Metro
 
 
+_EUROCIEL_DATE_AND_REF = re.compile(r"(?P<date>\d{2}/\d{2}/\d{2})(?P<invoice>(?:FA|AV)\d+)")
+_EUROCIEL_PRODUCT_LINE = re.compile(
+    r"^(?P<qty>\d+,\d{3})\s+"
+    r"(?P<unit>\d+,\d{2,4})\s+"
+    r"(?P<total>\d[\d\s]*,\d{2})\s+"
+    r"(?P<code>[A-Z]\d{1,3})(?P<name>.+)$"
+)
+_EUROCIEL_TVA_LINE = re.compile(r"^(?P<code>[A-Z]\d{1,3})\s+[\d\s,.]+?(?P<rate>\d+,\d+)%")
+
+
+def _parse_decimal_str(value: str | None) -> float | None:
+    if value is None:
+        return None
+    cleaned = str(value).replace("\xa0", " ").replace(" ", "").replace(",", ".")
+    try:
+        return float(cleaned)
+    except ValueError:
+        return None
+
+
+def _clean_eurociel_designation(value: str) -> str:
+    name = _normalize_product_name(value)
+    name = re.sub(r"\s*\*\s*$", "", name)
+    name = re.sub(r"\s+TOTAL$", "", name, flags=re.IGNORECASE)
+    name = re.sub(r"\s+\d+(?:,\d+)?\s*$", "", name)
+    name = re.sub(r"(?<=\D)\d{1,3}$", "", name)
+    return name.strip(" -")
+
+
+def extract_products_from_eurociel_invoice(raw_product_text: str, *, margin_rate: float = 0.0) -> pd.DataFrame:
+    """Parseur Eurociel (NOUTAM / L'INCONTOURNABLE) : lignes quantité / PU / total + code produit."""
+
+    lines = [line.strip() for line in (raw_product_text or "").replace("\r", "").splitlines() if line.strip()]
+    current_invoice_id: str | None = None
+    current_date: str | None = None
+    invoice_seq = 0
+    tva_lookup: dict[str, float] = {}
+    records: list[dict[str, object]] = []
+
+    for line in lines:
+        date_match = _EUROCIEL_DATE_AND_REF.search(line)
+        if date_match:
+            invoice_seq += 1
+            current_invoice_id = date_match.group("invoice")
+            current_date = date_match.group("date")
+            continue
+
+        tva_match = _EUROCIEL_TVA_LINE.match(line)
+        if tva_match:
+            rate = _parse_decimal_str(tva_match.group("rate"))
+            if rate is not None:
+                tva_lookup[tva_match.group("code")] = rate
+            continue
+
+        product_match = _EUROCIEL_PRODUCT_LINE.match(line)
+        if not product_match:
+            continue
+
+        qty = _parse_decimal_str(product_match.group("qty")) or 0.0
+        unit_price = _parse_decimal_str(product_match.group("unit")) or 0.0
+        line_total = _parse_decimal_str(product_match.group("total"))
+        code = product_match.group("code")
+        designation_raw = product_match.group("name")
+
+        effective_qty = qty
+        if unit_price > 0 and line_total is not None:
+            expected = round(unit_price * qty, 2)
+            if abs(expected - line_total) > 0.03:
+                effective_qty = round(line_total / unit_price, 3)
+                line_total = round(line_total, 2)
+
+        montant_ht = line_total if line_total is not None else round(unit_price * effective_qty, 2)
+        tva_value = tva_lookup.get(code, 5.5)
+        sale_price_ht = _ensure_margin(unit_price, None, margin_rate) or unit_price
+
+        if current_invoice_id is None:
+            invoice_seq += 1
+            current_invoice_id = f"INV-EUR-{invoice_seq:03d}"
+
+        records.append(
+            {
+                "nom": _clean_eurociel_designation(designation_raw),
+                "codes": code,
+                "numero_article": code,
+                "quantite_colis": effective_qty,
+                "colisage": 1,
+                "qte_init": effective_qty,
+                "prix_achat": round(unit_price, 2),
+                "prix_vente": round(sale_price_ht, 2),
+                "prix_vente_minimum": round(sale_price_ht, 2),
+                "tva": round(tva_value, 2),
+                "tva_code": code,
+                "montant_ht": round(montant_ht, 2),
+                "montant_tva": round(montant_ht * (tva_value / 100.0), 2),
+                "montant_ttc": round(montant_ht * (1.0 + tva_value / 100.0), 2),
+                "montant_total_facture": round(montant_ht, 2),
+                "facture_date": current_date,
+                "invoice_id": current_invoice_id,
+            }
+        )
+
+    if not records:
+        return pd.DataFrame()
+
+    desired_order: Iterable[str] = (
+        "nom",
+        "codes",
+        "numero_article",
+        "quantite_colis",
+        "colisage",
+        "qte_init",
+        "prix_achat",
+        "prix_vente",
+        "prix_vente_minimum",
+        "tva",
+        "tva_code",
+        "montant_ht",
+        "montant_tva",
+        "montant_ttc",
+        "montant_total_facture",
+        "facture_date",
+        "invoice_id",
+    )
+    df = pd.DataFrame(records)
+    available = [col for col in desired_order if col in df.columns]
+    return df.loc[:, available]
+
+
 # Enregistre les parseurs connus
 register_invoice_parser("metro", extract_products_from_metro_invoice)
 register_invoice_parser("generic", extract_products_from_generic_invoice)
 register_invoice_parser("pomona", extract_products_from_pomona_invoice)
 register_invoice_parser("transgourmet", extract_products_from_transgourmet_invoice)
+register_invoice_parser("eurociel", extract_products_from_eurociel_invoice)
diff --git a/core/price_history_service.py b/core/price_history_service.py
index 7544ab7..a5583a9 100644
--- a/core/price_history_service.py
+++ b/core/price_history_service.py
@@ -366,7 +366,6 @@ def fetch_price_history(
             prod_data.prix_vente,
             prod_data.stock_actuel,
             prod_data.seuil_alerte,
-            prod_data.ean,
             prod_data.marge_unitaire,
             prod_data.marge_pct,
             prod_data.margin_alert,
@@ -382,7 +381,6 @@ def fetch_price_history(
                 p.prix_vente,
                 p.stock_actuel,
                 p.seuil_alerte,
-                p.ean,
                 CASE
                     WHEN p.prix_vente > 0 THEN (p.prix_vente - f.prix_achat)
                     ELSE NULL
diff --git a/frontend/src/api/client.js b/frontend/src/api/client.js
index 8bd5f72..9031c18 100644
--- a/frontend/src/api/client.js
+++ b/frontend/src/api/client.js
@@ -59,7 +59,11 @@ api.interceptors.request.use((config) => {
  * Groupe de requêtes catalogue/inventaire/mouvements.
  */
 export const fetchProducts = async (params = {}) => {
-  const { data } = await api.get('/products', { params });
+  const sanitized = { ...params };
+  if (sanitized.category === 'all') delete sanitized.category;
+  if (sanitized.status === 'all') delete sanitized.status;
+  if (!sanitized.per_page) sanitized.per_page = 500;
+  const { data } = await api.get('/products', { params: sanitized });
   return data;
 };
 
diff --git a/frontend/src/features/catalog/CatalogPage.jsx b/frontend/src/features/catalog/CatalogPage.jsx
index 46154a2..10ce361 100644
--- a/frontend/src/features/catalog/CatalogPage.jsx
+++ b/frontend/src/features/catalog/CatalogPage.jsx
@@ -91,6 +91,7 @@ export default function CatalogPage() {
     category: 'all',
     status: 'all',
   });
+  const [sortMode, setSortMode] = useState('name');
   const [density, setDensity] = useState('comfortable');
   const [editor, setEditor] = useState({ open: false, mode: 'create', product: null });
   const [formValues, setFormValues] = useState(defaultForm);
@@ -142,11 +143,31 @@ export default function CatalogPage() {
       return matchesStatus && matchesCategory && matchesSearch;
     });
   }, [products, filters]);
+  const sortedProducts = useMemo(() => {
+    const base = [...filtered];
+    if (sortMode === 'category') {
+      return base.sort((a, b) => {
+        const catA = (a.categorie || '').toLocaleLowerCase();
+        const catB = (b.categorie || '').toLocaleLowerCase();
+        const byCat = catA.localeCompare(catB, 'fr', { sensitivity: 'base' });
+        if (byCat !== 0) return byCat;
+        return (a.nom || '').localeCompare(b.nom || '', 'fr', { sensitivity: 'base' });
+      });
+    }
+    return base.sort((a, b) => (a.nom || '').localeCompare(b.nom || '', 'fr', { sensitivity: 'base' }));
+  }, [filtered, sortMode]);
 
   const categories = useMemo(
     () => Array.from(new Set(products.map((p) => p.categorie ?? 'Non classé'))),
     [products],
   );
+  const categoryOptions = useMemo(
+    () =>
+      categories
+        .filter((category) => Boolean(category) && category !== 'Non classé')
+        .sort((a, b) => a.localeCompare(b, 'fr', { sensitivity: 'base' })),
+    [categories],
+  );
   const statusBreakdown = useMemo(() => {
     return filtered.reduce(
       (acc, product) => {
@@ -266,8 +287,8 @@ export default function CatalogPage() {
                       ))}
                     </select>
                   </div>
-                  <div className="space-y-1">
-                    <label className="text-xs font-semibold uppercase tracking-wide text-slate-500">Statut stock</label>
+                <div className="space-y-1">
+                  <label className="text-xs font-semibold uppercase tracking-wide text-slate-500">Statut stock</label>
                     <select
                       className="w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 shadow-sm focus:border-brand-400 focus:outline-none"
                       value={filters.status}
@@ -290,6 +311,17 @@ export default function CatalogPage() {
                     {density === 'compact' ? 'Confort' : 'Compacte'}
                   </Button>
                 </div>
+                <div className="space-y-1">
+                  <label className="text-xs font-semibold uppercase tracking-wide text-slate-500">Tri</label>
+                  <select
+                    className="w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm text-slate-900 shadow-sm focus:border-brand-400 focus:outline-none"
+                    value={sortMode}
+                    onChange={(event) => setSortMode(event.target.value)}
+                  >
+                    <option value="name">Nom (A→Z)</option>
+                    <option value="category">Catégorie (A→Z)</option>
+                  </select>
+                </div>
               </Card>
               <Card className="space-y-3 border-slate-200/80 bg-white">
                 <p className="text-xs uppercase tracking-[0.3em] text-slate-400">santé stock</p>
@@ -351,7 +383,7 @@ export default function CatalogPage() {
                           </tr>
                         </thead>
                         <tbody className="divide-y divide-slate-100 text-sm">
-                          {filtered.map((product) => {
+                          {sortedProducts.map((product) => {
                             const status = statusConfig[getStatus(product)];
                             return (
                               <tr key={product.id} className="hover:bg-slate-50/60">
@@ -549,12 +581,21 @@ export default function CatalogPage() {
           </div>
           <div className="grid gap-2">
             <label className="text-sm font-semibold text-slate-700">Catégorie</label>
-            <input
-              type="text"
+            <select
               className="rounded-2xl border border-slate-200 px-4 py-3 text-sm shadow-sm"
               value={formValues.categorie}
               onChange={handleChange('categorie')}
-            />
+            >
+              <option value="">Non classé / autre</option>
+              {categoryOptions.map((category) => (
+                <option key={category} value={category}>
+                  {category}
+                </option>
+              ))}
+            </select>
+            <p className="text-xs text-slate-500">
+              Sélectionnez une catégorie existante pour limiter les fautes de frappe.
+            </p>
           </div>
           <div className="grid gap-2">
             <label className="text-sm font-semibold text-slate-700">Codes-barres</label>
diff --git a/frontend/src/features/dashboard/DashboardPage.jsx b/frontend/src/features/dashboard/DashboardPage.jsx
index 4097f11..ee593fa 100644
--- a/frontend/src/features/dashboard/DashboardPage.jsx
+++ b/frontend/src/features/dashboard/DashboardPage.jsx
@@ -1,4 +1,4 @@
-import { useEffect, useMemo, useState } from 'react';
+import { useEffect, useMemo, useRef, useState } from 'react';
 import { useSearchParams } from 'react-router-dom';
 import { ArrowUpRight } from 'lucide-react';
 import Card from '../../components/ui/Card.jsx';
@@ -85,9 +85,12 @@ export default function DashboardPage() {
   const [focusToast, setFocusToast] = useState(null);
   const [weeklyWindow, setWeeklyWindow] = useState(8);
   const [eanSearch, setEanSearch] = useState('');
+  const [scannerMode, setScannerMode] = useState(false);
   const [productLookup, setProductLookup] = useState(null);
   const [productLookupError, setProductLookupError] = useState('');
   const [productLookupLoading, setProductLookupLoading] = useState(false);
+  const scanTimeoutRef = useRef(null);
+  const eanInputRef = useRef(null);
   const defaultPanel = SECTION_DEFINITIONS[0]?.groups?.[0]?.items?.[0]?.id ?? 'overview.core';
   const [searchParams, setSearchParams] = useSearchParams();
   const sectionParam = searchParams.get('section');
@@ -120,6 +123,9 @@ export default function DashboardPage() {
     const timeout = setTimeout(() => setFocusToast(null), 3000);
     return () => clearTimeout(timeout);
   }, [focusToast]);
+  useEffect(() => () => {
+    if (scanTimeoutRef.current) clearTimeout(scanTimeoutRef.current);
+  }, []);
 
   const handleFilterChange = (field, value) => {
     setFilters((prev) => ({
@@ -159,8 +165,9 @@ export default function DashboardPage() {
     setSearchParams(params);
   };
 
-  const handleProductLookup = async () => {
-    if (!eanSearch.trim()) {
+  const handleProductLookup = async (override = null) => {
+    const query = (override ?? eanSearch).trim();
+    if (!query) {
       setProductLookupError('Saisissez un code EAN pour lancer la recherche.');
       setProductLookup(null);
       return;
@@ -168,12 +175,16 @@ export default function DashboardPage() {
     setProductLookupLoading(true);
     setProductLookupError('');
     try {
-      const data = await lookupProductByBarcode(eanSearch.trim());
+      const data = await lookupProductByBarcode(query);
       if (!data) {
         setProductLookup(null);
         setProductLookupError('Produit introuvable.');
       } else {
         setProductLookup(data);
+        if (scannerMode) {
+          setEanSearch('');
+          if (eanInputRef.current) eanInputRef.current.focus();
+        }
       }
     } catch (error) {
       setProductLookup(null);
@@ -241,6 +252,7 @@ export default function DashboardPage() {
         };
       });
   }, [dashboardData?.weekly_variation, weeklyWindow]);
+  const hasWeeklyData = weeklySeries.length > 0;
 
   const categoryStockData = useMemo(() => {
     if (!products.length) return [];
@@ -347,13 +359,25 @@ export default function DashboardPage() {
                 Identifiez rapidement un produit et consultez ses informations (prix, stock, photo) depuis le cockpit.
               </p>
             </div>
-            <div className="flex flex-col gap-3 md:flex-row">
+            <div className="flex flex-col gap-3 md:flex-row md:items-end">
               <label className="flex-1 text-sm text-slate-600">
                 Code EAN
                 <input
                   type="text"
+                  ref={eanInputRef}
                   value={eanSearch}
-                  onChange={(event) => setEanSearch(event.target.value)}
+                  onChange={(event) => {
+                    const value = event.target.value;
+                    setEanSearch(value);
+                    if (scannerMode) {
+                      if (scanTimeoutRef.current) clearTimeout(scanTimeoutRef.current);
+                      if (value.trim().length >= 8) {
+                        scanTimeoutRef.current = setTimeout(() => {
+                          handleProductLookup();
+                        }, 180);
+                      }
+                    }
+                  }}
                   onKeyDown={(event) => {
                     if (event.key === 'Enter') {
                       event.preventDefault();
@@ -364,11 +388,29 @@ export default function DashboardPage() {
                   placeholder="Ex. 5411188114526"
                 />
               </label>
-              <Button
-                variant="brand"
-                className="md:self-end"
-                onClick={handleProductLookup}
-                disabled={productLookupLoading}
+              <div className="flex items-center gap-2 text-sm text-slate-600">
+                <input
+                  id="scanner-mode"
+                  type="checkbox"
+                  checked={scannerMode}
+                  onChange={(event) => {
+                    setScannerMode(event.target.checked);
+                    if (event.target.checked && eanInputRef.current) {
+                      eanInputRef.current.focus();
+                      setEanSearch('');
+                    }
+                  }}
+                  className="h-4 w-4 rounded border-slate-300 text-brand-500 focus:ring-brand-400"
+                />
+                <label htmlFor="scanner-mode" className="cursor-pointer select-none">
+                  Mode scanner (lecture auto)
+                </label>
+              </div>
+            <Button
+              variant="brand"
+              className="md:self-end"
+              onClick={handleProductLookup}
+              disabled={productLookupLoading}
               >
                 {productLookupLoading ? 'Recherche…' : 'Afficher la fiche'}
               </Button>
@@ -496,7 +538,7 @@ export default function DashboardPage() {
                 </div>
                 {dashboardLoading ? (
                   <p className="text-sm text-slate-500">Chargement…</p>
-                ) : (
+                ) : hasWeeklyData ? (
                   <div className="h-64">
                     <ResponsiveContainer width="100%" height="100%">
                       <AreaChart data={weeklySeries}>
@@ -510,6 +552,10 @@ export default function DashboardPage() {
                       </AreaChart>
                     </ResponsiveContainer>
                   </div>
+                ) : (
+                  <p className="text-sm text-slate-500">
+                    Aucune donnée de flux hebdomadaire disponible (Épicerie HQ).
+                  </p>
                 )}
               </div>
               <DashboardList
@@ -519,6 +565,7 @@ export default function DashboardPage() {
                 suffix=" %"
                 loading={dashboardLoading}
                 labelKey="nom"
+                fallbackText="Aucune donnée (Épicerie HQ)."
               />
             </Card>
             <Card className="flex flex-col gap-4">
@@ -608,14 +655,22 @@ export default function DashboardPage() {
   );
 }
 
-function DashboardList({ title, items, valueKey, labelKey = 'nom', loading, suffix = '' }) {
+function DashboardList({
+  title,
+  items,
+  valueKey,
+  labelKey = 'nom',
+  loading,
+  suffix = '',
+  fallbackText = 'Aucune donnée',
+}) {
   return (
     <div className="flex flex-col gap-3">
       <p className="text-xs uppercase tracking-[0.3em] text-slate-400">{title}</p>
       {loading ? (
         <p className="text-sm text-slate-500">Chargement…</p>
       ) : items.length === 0 ? (
-        <p className="text-sm text-slate-500">Aucune donnée</p>
+        <p className="text-sm text-slate-500">{fallbackText}</p>
       ) : (
         <ul className="space-y-2">
           {items.map((item, index) => (
@@ -635,3 +690,8 @@ function DashboardList({ title, items, valueKey, labelKey = 'nom', loading, suff
     </div>
   );
 }
+  useEffect(() => {
+    return () => {
+      if (scanTimeoutRef.current) clearTimeout(scanTimeoutRef.current);
+    };
+  }, []);
diff --git a/frontend/src/features/invoices/ImportPage.jsx b/frontend/src/features/invoices/ImportPage.jsx
index cb7cb09..10d1508 100644
--- a/frontend/src/features/invoices/ImportPage.jsx
+++ b/frontend/src/features/invoices/ImportPage.jsx
@@ -4,6 +4,8 @@ import { toast } from 'sonner';
 import Card from '../../components/ui/Card.jsx';
 import Button from '../../components/ui/Button.jsx';
 import FiltersDrawer from '../../components/ui/FiltersDrawer.jsx';
+import InvoiceList from './components/InvoiceList.jsx';
+import InvoiceHistoryTable from './components/InvoiceHistoryTable.jsx';
 import {
   useInvoiceExtraction,
   useInvoiceFileExtraction,
@@ -15,6 +17,38 @@ import { downloadInvoiceFile } from '../../api/client.js';
 
 const numberFormatter = new Intl.NumberFormat('fr-FR', { maximumFractionDigits: 2 });
 
+const extractNumericSuffix = (value) => {
+  if (!value) return null;
+  const match = String(value).match(/inv[-_]?(\d+)/i);
+  if (!match) return null;
+  return Number(match[1]);
+};
+
+const normalizeDateInput = (value) => {
+  if (!value) return '';
+  const text = String(value).trim();
+  if (!text) return '';
+
+  const isoMatch = text.match(/^(\d{4})[-/](\d{2})[-/](\d{2})/);
+  if (isoMatch) {
+    return `${isoMatch[1]}-${isoMatch[2]}-${isoMatch[3]}`;
+  }
+
+  const frMatch = text.match(/^(\d{2})[-/](\d{2})[-/](\d{4})/);
+  if (frMatch) {
+    return `${frMatch[3]}-${frMatch[2]}-${frMatch[1]}`;
+  }
+
+  const parsed = new Date(text);
+  if (!Number.isNaN(parsed.getTime())) {
+    const y = parsed.getFullYear();
+    const m = String(parsed.getMonth() + 1).padStart(2, '0');
+    const d = String(parsed.getDate()).padStart(2, '0');
+    return `${y}-${m}-${d}`;
+  }
+  return '';
+};
+
 const SECTION_DEFINITIONS = [
   {
     id: 'workspace',
@@ -30,16 +64,6 @@ const SECTION_DEFINITIONS = [
           },
         ],
       },
-      {
-        title: 'Catalogue',
-        items: [
-          {
-            id: 'workspace.catalog',
-            label: 'Mises à jour & rejets',
-            description: 'Synchronisation catalogue et export des lignes conflictuelles.',
-          },
-        ],
-      },
     ],
   },
   {
@@ -101,6 +125,7 @@ export default function ImportPage() {
   const [lines, setLines] = useState([]);
   const [documents, setDocuments] = useState([]);
   const [selectedDocumentId, setSelectedDocumentId] = useState(null);
+  const [selectedDocumentIds, setSelectedDocumentIds] = useState([]);
   const [supplier, setSupplier] = useState('');
   const [movementType, setMovementType] = useState('ENTREE');
   const [username, setUsername] = useState('');
@@ -115,13 +140,6 @@ export default function ImportPage() {
   const [searchParams, setSearchParams] = useSearchParams();
   const sectionParam = searchParams.get('section');
   const [activePanel, setActivePanel] = useState(sectionParam || defaultPanel);
-  useEffect(() => {
-    if (sectionParam && sectionParam !== activePanel) {
-      setActivePanel(sectionParam);
-    } else if (!sectionParam && activePanel !== defaultPanel) {
-      setActivePanel(defaultPanel);
-    }
-  }, [sectionParam, activePanel, defaultPanel]);
 
   const sectionOptions = useMemo(() => {
     const options = [];
@@ -137,6 +155,13 @@ export default function ImportPage() {
     });
     return options;
   }, []);
+  const allowedPanelIds = useMemo(() => new Set(sectionOptions.map((option) => option.id)), [sectionOptions]);
+  useEffect(() => {
+    const target = sectionParam && allowedPanelIds.has(sectionParam) ? sectionParam : defaultPanel;
+    if (target !== activePanel) {
+      setActivePanel(target);
+    }
+  }, [sectionParam, allowedPanelIds, activePanel, defaultPanel]);
 
   const handlePanelSelect = (panelId) => {
     const params = new URLSearchParams(searchParams);
@@ -152,7 +177,7 @@ export default function ImportPage() {
   const extractFileMutation = useInvoiceFileExtraction();
   const importMutation = useInvoiceImport();
   const catalogImportMutation = useInvoiceCatalogImport();
-  const historyQuery = useInvoiceHistory({ supplier: supplier || undefined, limit: 25 });
+  const historyQuery = useInvoiceHistory({ supplier: supplier || undefined, limit: 5000 });
   const historyItems = historyQuery.data ?? [];
 
   const normalizeLineItem = (item) => ({
@@ -160,16 +185,59 @@ export default function ImportPage() {
     prix_vente: Number(item.prix_vente ?? 0),
   });
 
+  const stripMetaFromLine = (line) => {
+    const { _documentId, _lineIndex, ...rest } = line;
+    return rest;
+  };
+
+  const buildLinesFromSelection = (sourceDocs, selectedIds) => {
+    if (!selectedIds?.length || !sourceDocs?.length) return [];
+    const selectedSet = new Set(selectedIds);
+    const aggregated = [];
+    sourceDocs.forEach((doc) => {
+      if (!selectedSet.has(doc.invoice_id)) return;
+      (doc.items ?? []).forEach((line, index) => {
+        aggregated.push({ ...line, invoice_id: doc.invoice_id, _documentId: doc.invoice_id, _lineIndex: index });
+      });
+    });
+    return aggregated;
+  };
+
   const buildDocumentsFromExtraction = (payload) => {
     if (!payload) {
       return [];
     }
+    const historyIds = historyItems.map((item) => item.invoice_id).filter(Boolean);
+    const currentIds = documents.map((doc) => doc.invoice_id).filter(Boolean);
+    const allocatedIds = new Set([...historyIds, ...currentIds]);
+    const initialMax = Math.max(
+      0,
+      ...historyIds.map((id) => extractNumericSuffix(id) || 0),
+      ...currentIds.map((id) => extractNumericSuffix(id) || 0),
+    );
+    let nextCounter = initialMax + 1;
+    const allocateSequentialId = () => {
+      const newId = `INV-${String(nextCounter).padStart(3, '0')}`;
+      nextCounter += 1;
+      return newId;
+    };
+    const resolveInvoiceId = (rawId) => {
+      const desired = (rawId || '').trim();
+      const desiredNum = extractNumericSuffix(desired);
+      if (!desired || allocatedIds.has(desired) || (desiredNum !== null && desiredNum <= initialMax)) {
+        const generated = allocateSequentialId();
+        allocatedIds.add(generated);
+        return generated;
+      }
+      allocatedIds.add(desired);
+      return desired;
+    };
     const hasDocuments = Array.isArray(payload.documents) && payload.documents.length > 0;
     const source = hasDocuments
       ? payload.documents
       : [
           {
-            invoice_id: payload.items?.[0]?.invoice_id ?? 'INV-001',
+            invoice_id: payload.items?.[0]?.invoice_id ?? allocateSequentialId(),
             facture_date: payload.items?.[0]?.facture_date ?? '',
             items: payload.items ?? [],
           },
@@ -177,11 +245,11 @@ export default function ImportPage() {
     return source
       .filter((entry) => entry && Array.isArray(entry.items))
       .map((entry, index) => {
-        const invoiceId = entry.invoice_id || `INV-${String(index + 1).padStart(3, '0')}`;
+        const invoiceId = resolveInvoiceId(entry.invoice_id || `INV-${String(index + 1).padStart(3, '0')}`);
         return {
           invoice_id: invoiceId,
-          facture_date: entry.facture_date ?? '',
-          items: (entry.items ?? []).map((line) => normalizeLineItem(line)),
+          facture_date: normalizeDateInput(entry.facture_date ?? ''),
+          items: (entry.items ?? []).map((line) => ({ ...normalizeLineItem(line), invoice_id: invoiceId })),
           pdf_path: entry.pdf_path ?? '',
         };
       });
@@ -208,26 +276,40 @@ export default function ImportPage() {
     }
   };
 
-  const selectDocument = (invoiceId, sourceDocs = documents) => {
-    const target = sourceDocs.find((doc) => doc.invoice_id === invoiceId);
-    if (!target) {
-      return;
+  useEffect(() => {
+    setLines(buildLinesFromSelection(documents, selectedDocumentIds));
+    if (selectedDocumentId && !selectedDocumentIds.includes(selectedDocumentId)) {
+      setSelectedDocumentId(selectedDocumentIds[0] ?? null);
     }
-    setSelectedDocumentId(invoiceId);
-    setLines(target.items);
-    setInvoiceDate(target.facture_date || '');
+  }, [documents, selectedDocumentIds, selectedDocumentId]);
+
+  useEffect(() => {
+    const selectedSet = new Set(selectedDocumentIds);
+    const firstDoc = documents.find((doc) => selectedSet.has(doc.invoice_id));
+    setInvoiceDate(normalizeDateInput(firstDoc?.facture_date || ''));
+  }, [documents, selectedDocumentIds]);
+
+  const resetWorkspace = () => {
+    setDocuments([]);
+    setSelectedDocumentId(null);
+    setSelectedDocumentIds([]);
+    setLines([]);
+    setInvoiceDate('');
+    setCatalogSummary(null);
+    setSummary(null);
+    setErrorMessage('');
+    setRawText('');
   };
 
   const applyExtractionResult = (payload) => {
     const normalizedDocs = buildDocumentsFromExtraction(payload);
     setDocuments(normalizedDocs);
-    if (normalizedDocs.length) {
-      selectDocument(normalizedDocs[0].invoice_id, normalizedDocs);
-    } else {
-      setSelectedDocumentId(null);
-      setLines([]);
-      setInvoiceDate('');
-    }
+    const allIds = normalizedDocs.map((doc) => doc.invoice_id);
+    setSelectedDocumentIds(allIds);
+    const firstDoc = normalizedDocs[0];
+    setSelectedDocumentId(firstDoc?.invoice_id ?? null);
+    setLines(buildLinesFromSelection(normalizedDocs, allIds));
+    setInvoiceDate(normalizeDateInput(firstDoc?.facture_date || ''));
     setErrorMessage('');
     historyQuery?.refetch?.();
   };
@@ -235,6 +317,7 @@ export default function ImportPage() {
   const handleFileChange = (event) => {
     const file = event.target.files?.[0];
     if (!file) return;
+    resetWorkspace();
     extractFileMutation.mutate(
       { file, marginPercent, supplierHint: supplier || null },
       {
@@ -247,6 +330,7 @@ export default function ImportPage() {
 
   const handleTextExtract = () => {
     if (!rawText.trim()) return;
+    resetWorkspace();
     extractTextMutation.mutate(
       { text: rawText, marginPercent, supplierHint: supplier || null },
       {
@@ -257,10 +341,16 @@ export default function ImportPage() {
     );
   };
 
-  const syncDocumentItems = (nextItems) => {
-    if (!selectedDocumentId) return;
+  const syncDocumentsFromLines = (nextLines) => {
+    const selectedSet = new Set(selectedDocumentIds);
     setDocuments((prevDocs) =>
-      prevDocs.map((doc) => (doc.invoice_id === selectedDocumentId ? { ...doc, items: nextItems } : doc)),
+      prevDocs.map((doc) => {
+        if (!selectedSet.has(doc.invoice_id)) return doc;
+        const nextItems = nextLines
+          .filter((line) => line._documentId === doc.invoice_id)
+          .map((line) => stripMetaFromLine(line));
+        return { ...doc, items: nextItems };
+      }),
     );
   };
 
@@ -276,7 +366,7 @@ export default function ImportPage() {
             }
           : line,
       );
-      syncDocumentItems(next);
+      syncDocumentsFromLines(next);
       return next;
     });
   };
@@ -284,26 +374,34 @@ export default function ImportPage() {
   const handleRemoveLine = (index) => {
     setLines((prev) => {
       const next = prev.filter((_, idx) => idx !== index);
-      syncDocumentItems(next);
+      syncDocumentsFromLines(next);
       return next;
     });
   };
 
-  const normaliseInvoiceDate = () => (invoiceDate ? invoiceDate : undefined);
+  const handleDuplicateLine = (index) => {
+    setLines((prev) => {
+      const target = prev[index];
+      if (!target) return prev;
+      const clone = { ...target };
+      const next = [...prev];
+      next.splice(index + 1, 0, clone);
+      syncDocumentsFromLines(next);
+      return next;
+    });
+  };
 
-  const handleInvoiceDateChange = (value) => {
-    setInvoiceDate(value);
-    if (!selectedDocumentId) return;
-    setDocuments((prevDocs) =>
-      prevDocs.map((doc) => (doc.invoice_id === selectedDocumentId ? { ...doc, facture_date: value } : doc)),
-    );
+  const normaliseInvoiceDate = () => {
+    const sanitized = normalizeDateInput(invoiceDate);
+    return sanitized || undefined;
   };
 
   const handleImport = () => {
     if (!lines.length) return;
+    const payloadLines = lines.map((line) => stripMetaFromLine(line));
     importMutation.mutate(
       {
-        lines,
+        lines: payloadLines,
         supplier,
         movementType,
         username,
@@ -322,9 +420,10 @@ export default function ImportPage() {
 
   const handleCatalogImport = () => {
     if (!lines.length) return;
+    const payloadLines = lines.map((line) => stripMetaFromLine(line));
     catalogImportMutation.mutate(
       {
-        lines,
+        lines: payloadLines,
         supplier,
         username,
         initializeStock,
@@ -365,46 +464,22 @@ export default function ImportPage() {
 
   const renderPanel = () => {
     switch (activePanel) {
-
-
       case 'workspace.intake':
         return (
           <>
             <Card className="flex flex-col gap-4">
-              <div>
+              <div className="flex flex-wrap items-center justify-between gap-3">
                 <p className="text-xs uppercase tracking-[0.4em] text-slate-400">factures détectées</p>
-                <h3 className="text-lg font-semibold text-slate-900">Sélectionnez la facture à traiter</h3>
+                <h3 className="text-lg font-semibold text-slate-900">Sélectionnez les factures à traiter</h3>
               </div>
-              {documents.length ? (
-                <div className="grid gap-3 md:grid-cols-2">
-                  {documents.map((doc) => {
-                    const isActive = doc.invoice_id === selectedDocumentId;
-                    return (
-                      <button
-                        type="button"
-                        key={doc.invoice_id}
-                        onClick={() => selectDocument(doc.invoice_id)}
-                        className={`flex flex-col rounded-2xl border px-4 py-3 text-left transition ${
-                          isActive ? 'border-brand-400 bg-brand-50 shadow-sm' : 'border-slate-200 bg-white'
-                        }`}
-                      >
-                        <div className="flex items-center justify-between">
-                          <p className="font-semibold text-slate-900">Facture {doc.invoice_id}</p>
-                          <span className="text-xs text-slate-500">{doc.items.length} lignes</span>
-                        </div>
-                        <p className="text-sm text-slate-600">Date : {doc.facture_date || 'non renseignée'}</p>
-                        {doc.pdf_path && (
-                          <p className="text-xs text-slate-500 break-words">Stockée : {doc.pdf_path}</p>
-                        )}
-                      </button>
-                    );
-                  })}
-                </div>
-              ) : (
-                <p className="text-sm text-slate-500">
-                  Analysez une facture (PDF/TXT) pour afficher ici les sous-documents détectés.
-                </p>
-              )}
+              <InvoiceList
+                documents={documents}
+                selectedDocumentIds={selectedDocumentIds}
+                setSelectedDocumentIds={setSelectedDocumentIds}
+                selectedDocumentId={selectedDocumentId}
+                setSelectedDocumentId={setSelectedDocumentId}
+                onReset={resetWorkspace}
+              />
             </Card>
 
             <Card className="flex flex-col gap-6">
@@ -574,7 +649,7 @@ export default function ImportPage() {
                               step="0.01"
                               value={line.tva ?? ''}
                               onChange={(event) => handleLineFieldChange(index, 'tva', event.target.value)}
-                              className="w-full rounded-xl border border-slate-200 px-3 py-1 focus-border-brand-400 focus:outline-none"
+                              className="w-full rounded-xl border border-slate-200 px-3 py-1 focus:border-brand-400 focus:outline-none"
                             />
                           </td>
                           <td className="px-3 py-2">
@@ -586,14 +661,14 @@ export default function ImportPage() {
                             />
                           </td>
                           <td className="px-3 py-2 text-right">
-                            <Button variant="ghost" size="xs" onClick={() => duplicateLine(index)}>
+                            <Button variant="ghost" size="xs" onClick={() => handleDuplicateLine(index)}>
                               Dupliquer
                             </Button>
                             <Button
                               variant="ghost"
                               size="xs"
                               className="text-rose-600"
-                              onClick={() => removeLine(index)}
+                              onClick={() => handleRemoveLine(index)}
                             >
                               Supprimer
                             </Button>
@@ -617,15 +692,12 @@ export default function ImportPage() {
                     className="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-brand-400 focus:outline-none"
                   />
                 </label>
-                <label className="text-sm text-slate-600">
+                <div className="text-sm text-slate-600">
                   Date facture
-                  <input
-                    type="date"
-                    value={invoiceDate}
-                    onChange={(event) => handleInvoiceDateChange(event.target.value)}
-                    className="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-brand-400 focus:outline-none"
-                  />
-                </label>
+                  <p className="mt-1 rounded-2xl border border-slate-200 bg-slate-50 px-4 py-2 text-sm text-slate-800">
+                    {invoiceDate || 'Auto (non détectée)'}
+                  </p>
+                </div>
                 <label className="text-sm text-slate-600">
                   Type de mouvement
                   <select
@@ -672,11 +744,7 @@ export default function ImportPage() {
                 </div>
               )}
             </Card>
-          </>
-        );
-      case 'workspace.catalog':
-        return (
-          <>
+
             <Card className="flex flex-col gap-4">
               <h3 className="text-lg font-semibold text-slate-900">Mettre à jour le catalogue</h3>
               <p className="text-sm text-slate-600">
@@ -722,16 +790,20 @@ export default function ImportPage() {
                 </div>
               )}
             </Card>
-
-            <Card className="flex flex-col gap-4">
-              <h3 className="text-lg font-semibold text-slate-900">Conflits & rejets</h3>
-              <p className="text-sm text-slate-600">
+          </>
+        );
+      case 'history.list':
+        return (
+          <Card className="flex flex-col gap-4">
+            <Card className="flex flex-col gap-3 border border-amber-200 bg-amber-50">
+              <h4 className="px-4 pt-4 text-base font-semibold text-amber-900">Conflits & rejets</h4>
+              <p className="px-4 text-sm text-amber-900">
                 Téléchargez les lignes rejetées pour corriger les anomalies (codes-barres en double, références
                 absentes, etc.).
               </p>
               {catalogSummary?.rejected_rows?.length ? (
-                <div className="rounded-xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-900">
-                  <p className="font-medium">
+                <div className="px-4 pb-4">
+                  <p className="text-sm font-medium text-amber-900">
                     {catalogSummary.rejected_rows.length} ligne(s) rejetée(s). Téléchargez le fichier pour les corriger
                     manuellement.
                   </p>
@@ -757,63 +829,20 @@ export default function ImportPage() {
                   )}
                 </div>
               ) : (
-                <p className="text-sm text-slate-500">Aucune ligne rejetée pour le moment.</p>
+                <p className="px-4 pb-4 text-sm text-amber-900">Aucune ligne rejetée pour le moment.</p>
               )}
             </Card>
-          </>
-        );
-      case 'history.list':
-        return (
-          <Card className="flex flex-col gap-4">
-            <div className="flex flex-wrap items-center justify-between gap-3">
-              <div>
-                <p className="text-xs uppercase tracking-[0.4em] text-slate-400">Historique</p>
-                <h3 className="text-lg font-semibold text-slate-900">Factures importées</h3>
-              </div>
-              <Button variant="ghost" size="sm" onClick={() => historyQuery?.refetch?.()}>
-                Actualiser
-              </Button>
-            </div>
             {historyQuery.isLoading ? (
               <p className="text-sm text-slate-500">Chargement…</p>
             ) : historyQuery.isError ? (
               <p className="text-sm text-rose-600">Impossible de charger l'historique.</p>
-            ) : historyItems.length ? (
-              <div className="overflow-x-auto">
-                <table className="min-w-full divide-y divide-slate-200 text-sm">
-                  <thead className="bg-slate-50 text-xs uppercase tracking-widest text-slate-500">
-                    <tr>
-                      <th className="px-3 py-2 text-left">Facture</th>
-                      <th className="px-3 py-2 text-left">Fournisseur</th>
-                      <th className="px-3 py-2 text-left">Date</th>
-                      <th className="px-3 py-2 text-right">Lignes</th>
-                      <th className="px-3 py-2 text-right">PDF</th>
-                    </tr>
-                  </thead>
-                  <tbody className="divide-y divide-slate-100">
-                    {historyItems.map((item) => (
-                      <tr key={item.invoice_id}>
-                        <td className="px-3 py-2 font-medium text-slate-900">{item.invoice_id}</td>
-                        <td className="px-3 py-2 text-slate-600">{item.supplier || '—'}</td>
-                        <td className="px-3 py-2 text-slate-600">{item.facture_date || '—'}</td>
-                        <td className="px-3 py-2 text-right text-slate-600">{item.line_count}</td>
-                        <td className="px-3 py-2 text-right">
-                          <Button
-                            variant="ghost"
-                            size="sm"
-                            onClick={() => handleDownloadInvoicePdf(item.invoice_id)}
-                            disabled={downloadingInvoice === item.invoice_id}
-                          >
-                            Télécharger
-                          </Button>
-                        </td>
-                      </tr>
-                    ))}
-                  </tbody>
-                </table>
-              </div>
             ) : (
-              <p className="text-sm text-slate-500">Aucune facture importée pour l'instant.</p>
+              <InvoiceHistoryTable
+                items={historyItems}
+                onRefresh={() => historyQuery?.refetch?.()}
+                onDownload={handleDownloadInvoicePdf}
+                downloadingId={downloadingInvoice}
+              />
             )}
           </Card>
         );
diff --git a/frontend/src/features/prices/PricesPage.jsx b/frontend/src/features/prices/PricesPage.jsx
index 4751ab8..06b9470 100644
--- a/frontend/src/features/prices/PricesPage.jsx
+++ b/frontend/src/features/prices/PricesPage.jsx
@@ -1,614 +1,22 @@
-/* @refresh reload */
-import { useMemo, useState } from 'react';
 import Card from '../../components/ui/Card.jsx';
 import Button from '../../components/ui/Button.jsx';
-import { ResponsiveContainer, LineChart, Line, AreaChart, Area, Tooltip, XAxis, YAxis, CartesianGrid, Legend, BarChart, Bar } from 'recharts';
-import { useProducts } from '../../hooks/useProducts.js';
-import { usePriceHistory } from '../../hooks/usePriceHistory.js';
-
-const numberFormatter = new Intl.NumberFormat('fr-FR', { maximumFractionDigits: 2 });
-const dateFormatter = new Intl.DateTimeFormat('fr-FR', { dateStyle: 'short', timeStyle: 'short' });
-
-const formatCurrency = (value) => `${numberFormatter.format(value || 0)} €`;
-
-const safeDateKey = (value) => {
-  if (!value) return null;
-  try {
-    return new Date(value).toISOString().slice(0, 10);
-  } catch {
-    return null;
-  }
-};
-
-const csvEscape = (value) => {
-  const text = value === null || value === undefined ? '' : String(value);
-  return `"${text.replace(/"/g, '""')}"`;
-};
-
-const formatDelta = (value) => {
-  if (!value) return '0 €';
-  const symbol = value > 0 ? '+' : '';
-  return `${symbol}${numberFormatter.format(value)} €`;
-};
-
-const formatPercentage = (value) => {
-  if (value === null || value === undefined) return '—';
-  const symbol = value > 0 ? '+' : '';
-  return `${symbol}${numberFormatter.format(value)} %`;
-};
-
-const downloadCsv = (rows) => {
-  if (!rows.length) return;
-  const headers = [
-    'Date',
-    'Produit',
-    'Code',
-    'Fournisseur',
-    'Prix vente',
-    'Prix achat',
-    'Delta prix',
-    'Delta %',
-    'Marge %',
-    'Alerte marge',
-    'Stock alerte',
-    'Ruptures récentes',
-    'Quantité',
-    'Montant',
-    'Contexte',
-  ];
-  const body = [headers, ...rows.map((row) => [
-    row.facture_date,
-    row.nom ?? '',
-    row.code ?? '',
-    row.fournisseur ?? '',
-    row.prix_vente ?? '',
-    row.prix_achat,
-    row.delta_prix ?? '',
-    row.delta_pct ?? '',
-    row.marge_pct ?? '',
-    row.margin_alert ?? '',
-    row.stockout_repeated ?? row.stock_alert ?? '',
-    row.stockout_events ?? '',
-    row.quantite ?? '',
-    row.montant ?? '',
-    row.source_context ?? '',
-  ])]
-    .map((line) => line.map(csvEscape).join(','))
-    .join('\n');
-  const blob = new Blob([body], { type: 'text/csv;charset=utf-8;' });
-  const url = URL.createObjectURL(blob);
-  const link = document.createElement('a');
-  link.href = url;
-  link.download = 'historique_prix.csv';
-  document.body.appendChild(link);
-  link.click();
-  document.body.removeChild(link);
-  URL.revokeObjectURL(url);
-};
 
 export default function PricesPage() {
-  const { data: products = [] } = useProducts();
-  const [filters, setFilters] = useState({
-    productId: 'all',
-    supplier: '',
-    code: '',
-    search: '',
-    dateStart: '',
-    dateEnd: '',
-    limit: 200,
-  });
-
-  const effectiveFilters = useMemo(
-    () => ({
-      productId: filters.productId === 'all' ? undefined : Number(filters.productId),
-      supplier: filters.supplier || undefined,
-      code: filters.code || undefined,
-      search: filters.search || undefined,
-      dateStart: filters.dateStart || undefined,
-      dateEnd: filters.dateEnd || undefined,
-      limit: filters.limit,
-    }),
-    [filters],
-  );
-
-
-  const historyQuery = usePriceHistory(effectiveFilters);
-  const items = historyQuery.data ?? [];
-  const sortedHistory = useMemo(
-    () =>
-      [...items].sort((a, b) => {
-        const dateA = new Date(a.facture_date || 0).valueOf();
-        const dateB = new Date(b.facture_date || 0).valueOf();
-        return dateA - dateB;
-      }),
-    [items],
-  );
-
-  const metrics = useMemo(() => {
-    if (!sortedHistory.length) {
-      return { min: 0, max: 0, last: 0, first: 0, avg: 0 };
-    }
-    const prices = sortedHistory.map((item) => Number(item.prix_achat ?? 0));
-    const min = Math.min(...prices);
-    const max = Math.max(...prices);
-    const last = prices[prices.length - 1];
-    const first = prices[0];
-    const avg = prices.reduce((sum, price) => sum + price, 0) / prices.length;
-    return { min, max, last, first, avg };
-  }, [sortedHistory]);
-
-  const priceDelta = metrics.last - metrics.first;
-  const deltaPct = metrics.first ? (priceDelta / metrics.first) * 100 : 0;
-
-  const timelineData = useMemo(() => {
-    if (!sortedHistory.length) return [];
-    const bucket = new Map();
-    sortedHistory.forEach((entry) => {
-      const key = safeDateKey(entry.facture_date);
-      if (!key) return;
-      const stored = bucket.get(key) || { date: key, total: 0, count: 0 };
-      stored.total += Number(entry.prix_achat ?? 0);
-      stored.count += 1;
-      bucket.set(key, stored);
-    });
-    const points = [...bucket.values()].sort((a, b) => new Date(a.date) - new Date(b.date));
-    const window = 5;
-    return points.map((point, index, arr) => {
-      const avg = point.total / (point.count || 1);
-      const slice = arr.slice(Math.max(0, index - window + 1), index + 1);
-      const moving =
-        slice.reduce((sum, entry) => sum + entry.total / (entry.count || 1), 0) / (slice.length || 1);
-      return {
-        date: point.date,
-        average: Number(avg.toFixed(4)),
-        moving: Number(moving.toFixed(4)),
-      };
-    });
-  }, [sortedHistory]);
-
-  const supplierBreakdown = useMemo(() => {
-    if (!sortedHistory.length) return [];
-    const totals = {};
-    sortedHistory.forEach((entry) => {
-      const supplier = entry.fournisseur || 'Non renseigné';
-      totals[supplier] = (totals[supplier] || 0) + Number(entry.montant ?? entry.prix_achat ?? 0);
-    });
-    return Object.entries(totals)
-      .sort((a, b) => b[1] - a[1])
-      .slice(0, 8)
-      .map(([supplier, value]) => ({ supplier, value: Number(value.toFixed(2)) }));
-  }, [sortedHistory]);
-
-  const productVariations = useMemo(() => {
-    if (!sortedHistory.length) return [];
-    const groups = new Map();
-    sortedHistory.forEach((entry) => {
-      const key = entry.produit_id || entry.code || entry.nom || 'Produit';
-      const list = groups.get(key) || [];
-      list.push(entry);
-      groups.set(key, list);
-    });
-    return [...groups.entries()]
-      .map(([label, list]) => {
-        const sorted = [...list].sort((a, b) => new Date(b.facture_date || 0) - new Date(a.facture_date || 0));
-        if (sorted.length < 2) return null;
-        const latest = sorted[0];
-        const previous = sorted[1];
-        const lastPrice = Number(latest.prix_achat ?? 0);
-        const prevPrice = Number(previous.prix_achat ?? 0);
-        const delta = lastPrice - prevPrice;
-        const pct = prevPrice ? (delta / prevPrice) * 100 : null;
-        return {
-          label,
-          name: latest.nom || previous.nom || '—',
-          code: latest.code || previous.code || '—',
-          latest: lastPrice,
-          previous: prevPrice,
-          delta,
-          pct,
-          supplier: latest.fournisseur || previous.fournisseur || '—',
-        };
-      })
-      .filter(Boolean);
-  }, [sortedHistory]);
-
-  const topIncreases = useMemo(
-    () => [...productVariations].filter((entry) => entry.delta > 0).sort((a, b) => b.delta - a.delta).slice(0, 5),
-    [productVariations],
-  );
-  const topDrops = useMemo(
-    () => [...productVariations].filter((entry) => entry.delta < 0).sort((a, b) => a.delta - b.delta).slice(0, 5),
-    [productVariations],
-  );
-
-  const alertItems = useMemo(
-    () =>
-      items.filter(
-        (entry) => entry.margin_alert || entry.stock_alert || entry.stockout_repeated,
-      ),
-    [items],
-  );
-
   return (
-    <div className="flex flex-col gap-6">
-      <Card className="flex flex-col gap-4">
-        <div className="flex flex-col gap-2 md:flex-row md:items-end md:justify-between">
-          <div>
-            <p className="text-xs uppercase tracking-[0.4em] text-slate-400">prix & inflation</p>
-            <h2 className="text-2xl font-semibold text-slate-900">Historique fournisseur</h2>
-            <p className="text-sm text-slate-500">
-              Comparez les évolutions de prix d&apos;achat par produit, fournisseur et période.
-            </p>
-          </div>
-          <div className="flex flex-wrap gap-3">
-            <Button variant="ghost" size="sm" onClick={() => downloadCsv(items)} disabled={!items.length}>
-              Export CSV
-            </Button>
-          </div>
-        </div>
-        <div className="grid gap-4 md:grid-cols-3">
-          <label className="text-sm text-slate-600">
-            Produit
-            <select
-              value={filters.productId}
-              onChange={(event) => setFilters((prev) => ({ ...prev, productId: event.target.value }))}
-              className="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-brand-400 focus:outline-none"
-            >
-              <option value="all">Catalogue complet</option>
-              {products.map((product) => (
-                <option key={product.id} value={product.id}>
-                  {product.nom} #{product.id}
-                </option>
-              ))}
-            </select>
-          </label>
-          <label className="text-sm text-slate-600">
-            Fournisseur
-            <input
-              type="text"
-              value={filters.supplier}
-              onChange={(event) => setFilters((prev) => ({ ...prev, supplier: event.target.value }))}
-              className="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-brand-400 focus:outline-none"
-              placeholder="Metro, Grossiste..."
-            />
-          </label>
-          <label className="text-sm text-slate-600">
-            Code/EAN
-            <input
-              type="text"
-              value={filters.code}
-              onChange={(event) => setFilters((prev) => ({ ...prev, code: event.target.value }))}
-              className="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-brand-400 focus:outline-none"
-              placeholder="1234567890123"
-            />
-          </label>
-        </div>
-        <div className="grid gap-4 md:grid-cols-3">
-          <label className="text-sm text-slate-600">
-            Recherche libre
-            <input
-              type="text"
-              value={filters.search}
-              onChange={(event) => setFilters((prev) => ({ ...prev, search: event.target.value }))}
-              className="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-brand-400 focus:outline-none"
-              placeholder="Nom produit, context..."
-            />
-          </label>
-          <label className="text-sm text-slate-600">
-            Début
-            <input
-              type="date"
-              value={filters.dateStart}
-              onChange={(event) => setFilters((prev) => ({ ...prev, dateStart: event.target.value }))}
-              className="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-brand-400 focus:outline-none"
-            />
-          </label>
-          <label className="text-sm text-slate-600">
-            Fin
-            <input
-              type="date"
-              value={filters.dateEnd}
-              onChange={(event) => setFilters((prev) => ({ ...prev, dateEnd: event.target.value }))}
-              className="mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-brand-400 focus:outline-none"
-            />
-          </label>
-        </div>
-      </Card>
-
-      <Card className="grid gap-4 lg:grid-cols-4">
-        <Metric
-          label="Dernier prix"
-          value={formatCurrency(metrics.last)}
-          hint={`vs début ${formatDelta(priceDelta)}`}
-          accent="text-slate-900"
-        />
-        <Metric
-          label="Variation"
-          value={formatDelta(priceDelta)}
-          hint={formatPercentage(deltaPct)}
-          accent={priceDelta >= 0 ? 'text-rose-600' : 'text-emerald-600'}
-        />
-        <Metric label="Prix moyen" value={formatCurrency(metrics.avg)} hint="Période filtrée" />
-        <Metric
-          label="Fourchette"
-          value={`${formatCurrency(metrics.min)} → ${formatCurrency(metrics.max)}`}
-          hint="Minimum / Maximum observés"
-        />
-      </Card>
-
-      <Card className="flex flex-col gap-3 border-amber-200 bg-amber-50">
-        <div className="flex items-center justify-between">
-          <div>
-            <p className="text-xs uppercase tracking-[0.35em] text-amber-600">alertes prix/stock</p>
-            <h3 className="text-lg font-semibold text-amber-900">
-              {alertItems.length} alerte{alertItems.length > 1 ? 's' : ''}
-            </h3>
-          </div>
-          <span className="rounded-full bg-white px-3 py-1 text-xs font-semibold text-amber-700 shadow-sm">
-            Marges <span className="font-bold">{alertItems.filter((a) => a.margin_alert).length}</span> · Ruptures{' '}
-            <span className="font-bold">{alertItems.filter((a) => a.stock_alert || a.stockout_repeated).length}</span>
-          </span>
-        </div>
-        {alertItems.length ? (
-          <div className="overflow-x-auto">
-            <table className="min-w-full divide-y divide-amber-100 text-sm">
-              <thead>
-                <tr className="text-left text-xs uppercase tracking-widest text-amber-700">
-                  <th className="px-3 py-2">Produit</th>
-                  <th className="px-3 py-2">Prix achat</th>
-                  <th className="px-3 py-2">Marge</th>
-                  <th className="px-3 py-2">Rupture</th>
-                </tr>
-              </thead>
-              <tbody className="divide-y divide-amber-100">
-                {alertItems.slice(0, 6).map((item) => (
-                  <tr key={`${item.id ?? item.code}-${item.facture_date}`}>
-                    <td className="px-3 py-2">
-                      <p className="font-semibold text-amber-900">{item.nom ?? '—'}</p>
-                      <p className="text-xs text-amber-700">{item.code ?? '—'}</p>
-                    </td>
-                    <td className="px-3 py-2 text-amber-900">{formatCurrency(item.prix_achat)}</td>
-                    <td className="px-3 py-2">
-                      {item.marge_pct !== null && item.marge_pct !== undefined ? (
-                        <span
-                          className={`rounded-full px-3 py-1 text-xs font-semibold ${
-                            item.margin_alert
-                              ? 'bg-rose-100 text-rose-700'
-                              : 'bg-emerald-100 text-emerald-700'
-                          }`}
-                        >
-                          {formatPercentage(item.marge_pct)}
-                        </span>
-                      ) : (
-                        <span className="text-xs text-amber-700">N/C</span>
-                      )}
-                    </td>
-                    <td className="px-3 py-2 space-x-2">
-                      {item.stock_alert && (
-                        <span className="rounded-full bg-rose-100 px-3 py-1 text-xs font-semibold text-rose-700">
-                          Stock critique
-                        </span>
-                      )}
-                      {item.stockout_repeated && (
-                        <span className="rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-800">
-                          Ruptures ({item.stockout_events || 0})
-                        </span>
-                      )}
-                    </td>
-                  </tr>
-                ))}
-              </tbody>
-            </table>
-          </div>
-        ) : (
-          <p className="text-sm text-amber-800">
-            Aucune alerte active sur les marges ou les ruptures répétées pour ces filtres.
+    <div className="min-h-screen bg-slate-50 p-6">
+      <div className="mx-auto flex w-full max-w-4xl flex-col gap-4">
+        <Card className="space-y-2">
+          <p className="text-xs uppercase tracking-[0.3em] text-slate-400">Suivi prix</p>
+          <h2 className="text-2xl font-semibold text-slate-900">Module temporairement désactivé</h2>
+          <p className="text-sm text-slate-600">
+            L&apos;historique prix est en pause le temps de stabiliser l&apos;application. Vous pouvez revenir au
+            tableau de bord et relancer plus tard.
           </p>
-        )}
-      </Card>
-
-      <div className="grid gap-6 lg:grid-cols-[2fr,1fr]">
-        <Card className="flex flex-col gap-4">
-          <div className="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
-            <div>
-              <p className="text-xs uppercase tracking-[0.4em] text-slate-400">Courbe de prix</p>
-              <h3 className="text-lg font-semibold text-slate-900">Evolution moyenne journalière</h3>
-            </div>
-            <p className="text-xs text-slate-500">
-              {timelineData.length} points • glissante 5 jours
-            </p>
-          </div>
-          {timelineData.length ? (
-            <div className="h-72">
-              <ResponsiveContainer width="100%" height="100%">
-                <LineChart data={timelineData}>
-                  <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
-                  <XAxis dataKey="date" tick={{ fontSize: 11 }} />
-                  <YAxis />
-                  <Tooltip formatter={(value) => `${numberFormatter.format(value)} €`} />
-                  <Legend />
-                  <Area type="monotone" dataKey="moving" stroke="#6366f1" fill="#6366f1" fillOpacity={0.1} name="Moyenne mobile" />
-                  <Line type="monotone" dataKey="average" stroke="#0ea5e9" strokeWidth={2} dot={false} name="Moyenne quotidienne" />
-                </LineChart>
-              </ResponsiveContainer>
-            </div>
-          ) : (
-            <p className="text-sm text-slate-500">Pas encore d&apos;historique pour ces filtres.</p>
-          )}
+          <Button as="a" href="/" variant="brand">
+            Retour dashboard
+          </Button>
         </Card>
-
-        <Card className="flex flex-col gap-4">
-          <div>
-            <p className="text-xs uppercase tracking-[0.4em] text-slate-400">Fournisseurs</p>
-            <h3 className="text-lg font-semibold text-slate-900">Top contributeurs</h3>
-          </div>
-          {supplierBreakdown.length ? (
-            <div className="h-72">
-              <ResponsiveContainer width="100%" height="100%">
-                <BarChart data={supplierBreakdown} layout="vertical" margin={{ left: 0, right: 10, top: 10, bottom: 10 }}>
-                  <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
-                  <XAxis type="number" />
-                  <YAxis dataKey="supplier" type="category" width={120} />
-                  <Tooltip formatter={(value) => formatCurrency(value)} />
-                  <Bar dataKey="value" fill="#f97316" />
-                </BarChart>
-              </ResponsiveContainer>
-            </div>
-          ) : (
-            <p className="text-sm text-slate-500">Aucun fournisseur identifié.</p>
-          )}
-        </Card>
-      </div>
-
-      <Card className="grid gap-6 lg:grid-cols-2">
-        <VariationList title="Top hausses" items={topIncreases} emptyLabel="Aucune hausse détectée." accent="text-rose-600" />
-        <VariationList title="Top baisses" items={topDrops} emptyLabel="Aucune détente constatée." accent="text-emerald-600" />
-      </Card>
-
-      {!historyQuery.isLoading && items.length === 0 && (
-        <Card className="flex flex-col gap-2 border border-amber-200 bg-amber-50 text-sm text-amber-900">
-          <p className="font-semibold">Aucune statistique enregistrée</p>
-          <p>
-            L&apos;historique se remplit lors de l&apos;import de factures (onglet Factures → Commandes)
-            ou via l&apos;API `record_price_history`. Réimporte tes factures PDF/CSV pour reconstruire les
-            2 dernières années ou utilise le script `price_history_service.record_price_history` pour
-            charger un fichier existant.
-          </p>
-        </Card>
-      )}
-
-      <Card className="flex flex-col gap-4">
-        <div className="flex items-center justify-between">
-          <h3 className="text-lg font-semibold text-slate-900">Historique des prix</h3>
-          <p className="text-sm text-slate-500">{items.length} entrée(s)</p>
-        </div>
-        {items.length ? (
-          <div className="overflow-x-auto">
-              <table className="min-w-full divide-y divide-slate-100 text-sm">
-                <thead>
-                  <tr className="text-left text-xs uppercase tracking-widest text-slate-500">
-                    <th className="px-3 py-2">Date</th>
-                    <th className="px-3 py-2">Produit</th>
-                    <th className="px-3 py-2">Code</th>
-                    <th className="px-3 py-2">Fournisseur</th>
-                    <th className="px-3 py-2">Prix achat</th>
-                    <th className="px-3 py-2">Δ prix</th>
-                    <th className="px-3 py-2">Marge</th>
-                    <th className="px-3 py-2">Quantité</th>
-                    <th className="px-3 py-2">Montant</th>
-                    <th className="px-3 py-2">Contexte</th>
-                  </tr>
-                </thead>
-                <tbody className="divide-y divide-slate-100">
-                  {items.map((item) => (
-                    <tr key={item.id ?? `${item.code}-${item.facture_date}`}>
-                    <td className="px-3 py-2 text-slate-500">
-                      {item.facture_date ? dateFormatter.format(new Date(item.facture_date)) : '—'}
-                    </td>
-                    <td className="px-3 py-2 text-slate-900">{item.nom ?? '—'}</td>
-                    <td className="px-3 py-2 text-slate-600">{item.code ?? '—'}</td>
-                    <td className="px-3 py-2 text-slate-600">{item.fournisseur ?? '—'}</td>
-                    <td className="px-3 py-2">{numberFormatter.format(item.prix_achat ?? 0)} €</td>
-                    <td className="px-3 py-2">
-                      {item.delta_prix !== null && item.delta_prix !== undefined ? (
-                        <span
-                          className={`rounded-full px-2.5 py-1 text-xs font-semibold ${
-                            item.delta_prix > 0 ? 'bg-rose-50 text-rose-700' : item.delta_prix < 0 ? 'bg-emerald-50 text-emerald-700' : 'bg-slate-100 text-slate-700'
-                          }`}
-                        >
-                          {formatDelta(item.delta_prix)} ({formatPercentage(item.delta_pct)})
-                        </span>
-                      ) : (
-                        '—'
-                      )}
-                    </td>
-                    <td className="px-3 py-2">
-                      {item.marge_pct !== null && item.marge_pct !== undefined ? (
-                        <span
-                          className={`rounded-full px-2.5 py-1 text-xs font-semibold ${
-                            item.margin_alert
-                              ? 'bg-rose-100 text-rose-700'
-                              : 'bg-emerald-100 text-emerald-700'
-                          }`}
-                        >
-                          {formatPercentage(item.marge_pct)}
-                        </span>
-                      ) : (
-                        <span className="text-xs text-slate-500">N/C</span>
-                      )}
-                      {(item.stock_alert || item.stockout_repeated) && (
-                        <div className="mt-1 space-x-1">
-                          {item.stock_alert && (
-                            <span className="rounded-full bg-amber-100 px-2 py-0.5 text-[11px] font-semibold text-amber-800">
-                              Stock critique
-                            </span>
-                          )}
-                          {item.stockout_repeated && (
-                            <span className="rounded-full bg-rose-100 px-2 py-0.5 text-[11px] font-semibold text-rose-700">
-                              Ruptures {item.stockout_events ?? 0}
-                            </span>
-                          )}
-                        </div>
-                      )}
-                    </td>
-                    <td className="px-3 py-2">{item.quantite ?? '—'}</td>
-                    <td className="px-3 py-2">{item.montant ? `${numberFormatter.format(item.montant)} €` : '—'}</td>
-                    <td className="px-3 py-2 text-slate-500">{item.source_context ?? '—'}</td>
-                  </tr>
-                ))}
-              </tbody>
-            </table>
-          </div>
-        ) : (
-          <p className="text-sm text-slate-500">
-            {historyQuery.isLoading ? 'Chargement…' : 'Aucune donnée pour ces filtres.'}
-          </p>
-        )}
-      </Card>
-    </div>
-  );
-}
-
-function Metric({ label, value, hint, accent = 'text-slate-900' }) {
-  return (
-    <div className="rounded-2xl border border-slate-200 bg-white p-4">
-      <p className="text-xs font-semibold uppercase tracking-widest text-slate-400">{label}</p>
-      <p className={`text-2xl font-semibold ${accent}`}>{value}</p>
-      {hint && <p className="text-xs text-slate-500">{hint}</p>}
-    </div>
-  );
-}
-
-function VariationList({ title, items, emptyLabel, accent }) {
-  return (
-    <div className="flex flex-col gap-3">
-      <div>
-        <p className="text-xs uppercase tracking-[0.4em] text-slate-400">{title}</p>
-        <p className="text-sm text-slate-500">Comparatif entre les deux dernières variations</p>
       </div>
-      {items.length === 0 ? (
-        <p className="text-sm text-slate-500">{emptyLabel}</p>
-      ) : (
-        <ul className="divide-y divide-slate-100 text-sm">
-          {items.map((entry) => (
-            <li key={entry.label} className="flex flex-col gap-1 py-2">
-              <div className="flex items-center justify-between">
-                <div>
-                  <p className="font-semibold text-slate-900">{entry.name || entry.label}</p>
-                  <p className="text-xs text-slate-500">
-                    {entry.code && entry.code !== '—' ? `${entry.code} · ` : ''}
-                    {entry.supplier}
-                  </p>
-                </div>
-                <span className={`text-sm font-semibold ${accent}`}>{formatDelta(entry.delta)}</span>
-              </div>
-              <p className="text-xs text-slate-500">
-                {formatCurrency(entry.previous)} → {formatCurrency(entry.latest)} ({formatPercentage(entry.pct)})
-              </p>
-            </li>
-          ))}
-        </ul>
-      )}
     </div>
   );
 }
diff --git a/frontend/src/features/restaurant/BankStatementAnalyzer.jsx b/frontend/src/features/restaurant/BankStatementAnalyzer.jsx
index 085fab0..cde45d3 100644
--- a/frontend/src/features/restaurant/BankStatementAnalyzer.jsx
+++ b/frontend/src/features/restaurant/BankStatementAnalyzer.jsx
@@ -1,1536 +1,25 @@
-import React, { useEffect, useMemo, useState } from 'react';
-import { Download, Calendar, TrendingDown, Filter, Eye } from 'lucide-react';
 import Card from '../../components/ui/Card.jsx';
 import Button from '../../components/ui/Button.jsx';
-import {
-  Area,
-  AreaChart,
-  Bar,
-  BarChart,
-  CartesianGrid,
-  Legend,
-  ResponsiveContainer,
-  Tooltip,
-  XAxis,
-  YAxis,
-} from 'recharts';
-import {
-  useRestaurantBankStatements,
-  useCreateRestaurantBankStatement,
-  useUpdateRestaurantBankStatement,
-  useImportRestaurantBankStatementsPdf,
-  useRestaurantBankStatementSummary,
-  useRestaurantBankAccountsOverview,
-  useCreateExpenseFromBankStatement,
-  useRestaurantCategories,
-  useRestaurantCostCenters,
-} from '../../hooks/useRestaurant.js';
-import { aggregateTimeline, buildCategoryBuckets, roundAmount } from '../../utils/banking.js';
-
-const SUMMARY_MONTH_OPTIONS = [
-  { value: 'all', label: "Tout l'historique" },
-  { value: '3', label: '3 mois' },
-  { value: '6', label: '6 mois' },
-  { value: '12', label: '12 mois' },
-];
-
-const SUMMARY_RESOLUTION_OPTIONS = [
-  { value: 'monthly', label: 'Mensuel' },
-  { value: 'weekly', label: 'Hebdomadaire' },
-  { value: 'daily', label: 'Journalier' },
-];
-
-const ACCOUNT_STATUS_STYLES = {
-  connected: 'bg-emerald-100 text-emerald-700',
-  error: 'bg-rose-100 text-rose-700',
-  warning: 'bg-amber-100 text-amber-700',
-  disconnected: 'bg-slate-100 text-slate-500',
-  disabled: 'bg-slate-100 text-slate-500',
-};
-
-const CATEGORY_COLOR_PALETTE = ['#2563eb', '#0ea5e9', '#10b981', '#f97316', '#ec4899', '#8b5cf6', '#94a3b8'];
-
-
-const formatCurrency = (value) => {
-  const amount = Math.abs(value || 0).toLocaleString('fr-FR', {
-    minimumFractionDigits: 2,
-    maximumFractionDigits: 2,
-  });
-  return `${value < 0 ? '-' : ''}${amount} €`;
-};
-
-const StatusBadge = ({ status, children }) => {
-  const base = ACCOUNT_STATUS_STYLES[status] || 'bg-slate-100 text-slate-600';
-  return (
-    <span className={`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold ${base}`}>
-      {children}
-    </span>
-  );
-};
-
-const GuidedTip = ({ title, description }) => (
-  <div className="rounded-2xl border border-indigo-100 bg-indigo-50/70 p-4 text-sm text-slate-700 shadow-sm">
-    <p className="font-semibold text-slate-900">{title}</p>
-    <p className="mt-1 text-slate-600">{description}</p>
-  </div>
-);
-
-const KpiCard = ({ label, value, hint, accent = 'text-slate-900' }) => (
-  <div className="rounded-2xl border border-slate-200 bg-white p-4">
-    <p className="text-xs uppercase tracking-[0.3em] text-slate-400">{label}</p>
-    <p className={`text-2xl font-semibold ${accent}`}>{value}</p>
-    {hint && <p className="text-xs text-slate-500">{hint}</p>}
-  </div>
-);
-
-const CategoryTag = ({ label, color = '#cbd5f5' }) => (
-  <span
-    className="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold text-white"
-    style={{ backgroundColor: color }}
-  >
-    {label}
-  </span>
-);
-
-const ACCOUNT_DATA = {
-  incontournable: {
-    label: 'Incontournable (restaurant)',
-    provider: 'Crédit Agricole',
-    status: 'connected',
-    color: 'emerald',
-    accounts: [
-      { label: 'Compte courant', balance: 45001.58, currency: '€', status: 'connected' },
-      { label: 'LDD', balance: 12000, currency: '€', status: 'connected' },
-    ],
-    transactions: [
-      { date: '2024-06-28', libelle: 'VIR SEPA NOUTAM', categorie: 'Fournisseur', montant: 720.0, mois: '2024-06', type: 'Sortie' },
-      { date: '2024-06-30', libelle: 'TRAIT.IRREG.FONCT.CTE', categorie: 'Frais bancaires', montant: 19.2, mois: '2024-06', type: 'Sortie' },
-      { date: '2024-07-01', libelle: 'SFR FIXE ADSL', categorie: 'Télécom', montant: 48.99, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-01', libelle: 'PRLV SEPA METRO CASH CARRY', categorie: 'Fournisseur alimentaire', montant: 3629.11, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-01', libelle: 'VERSEMENT ALS', categorie: 'Encaissement', montant: 2745.0, mois: '2024-07', type: 'Entrée' },
-      { date: '2024-07-01', libelle: 'VERSEMENT ALS', categorie: 'Encaissement', montant: 1200.0, mois: '2024-07', type: 'Entrée' },
-      { date: '2024-07-04', libelle: 'PRLV SEPA CANALSAT', categorie: 'Abonnements', montant: 35.99, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-05', libelle: 'PRLV SEPA SPB', categorie: 'Services professionnels', montant: 4.41, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-05', libelle: 'PRLV SEPA HMD AUDIT ET CONSEIL', categorie: 'Services professionnels', montant: 316.5, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-09', libelle: 'PRLV SEPA ENGIE', categorie: 'Électricité', montant: 477.68, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-09', libelle: 'VIR SEPA ADOHINZIN AYABA (salaire)', categorie: 'Salaires', montant: 1437.39, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-10', libelle: 'PRLV SEPA METRO CASH CARRY', categorie: 'Fournisseur alimentaire', montant: 799.6, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-10', libelle: 'VERSEMENT ALS', categorie: 'Encaissement', montant: 1810.0, mois: '2024-07', type: 'Entrée' },
-      { date: '2024-07-10', libelle: 'VERSEMENT ALS', categorie: 'Encaissement', montant: 170.0, mois: '2024-07', type: 'Entrée' },
-      { date: '2024-07-11', libelle: 'PRLV SEPA GAZELENERGIE', categorie: 'Gaz', montant: 468.51, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-11', libelle: 'PRLV SEPA PREFILOC CAPITAL', categorie: 'Loyer/Location', montant: 18.6, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-12', libelle: 'PRLV SEPA METRO CASH CARRY', categorie: 'Fournisseur alimentaire', montant: 155.6, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-15', libelle: 'VIR SEPA residence St an (loyer)', categorie: 'Loyer/Location', montant: 2000.0, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-15', libelle: 'VERSEMENT ALS', categorie: 'Encaissement', montant: 7770.0, mois: '2024-07', type: 'Entrée' },
-      { date: '2024-07-16', libelle: 'PRLV SEPA METRO CASH CARRY', categorie: 'Fournisseur alimentaire', montant: 1013.83, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-16', libelle: 'PRLV SEPA URSSAF', categorie: 'Charges sociales', montant: 436.0, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-16', libelle: 'VIR SEPA MASSA ANGELE (salaire)', categorie: 'Salaires', montant: 2079.13, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-17', libelle: 'PRLV SEPA METRO CASH CARRY', categorie: 'Fournisseur alimentaire', montant: 110.19, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-17', libelle: 'VERSEMENT ALS', categorie: 'Encaissement', montant: 806.2, mois: '2024-07', type: 'Entrée' },
-      { date: '2024-07-17', libelle: 'PRLV SEPA B2B DGFIP (TVA)', categorie: 'Impôts et taxes', montant: 1415.0, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-18', libelle: 'VIR SEPA noutam sas (achat)', categorie: 'Fournisseur', montant: 3000.0, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-19', libelle: 'PRLV SEPA B2B DGFIP (TVA)', categorie: 'Impôts et taxes', montant: 4214.0, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-19', libelle: 'VERSEMENT ALS', categorie: 'Encaissement', montant: 3475.0, mois: '2024-07', type: 'Entrée' },
-      { date: '2024-07-22', libelle: 'VIR SEPA noutam sas (achat)', categorie: 'Fournisseur', montant: 702.0, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-23', libelle: 'VIR INST gnanam exotique (achat)', categorie: 'Fournisseur', montant: 428.84, mois: '2024-07', type: 'Sortie' },
-      { date: '2024-07-24', libelle: 'PRLV SEPA METRO CASH CARRY', categorie: 'Fournisseur alimentaire', montant: 130.21, mois: '2024-07', type: 'Sortie' },
-    ],
-  },
-  noutam: {
-    label: 'Noutam (épicerie)',
-    provider: 'Revolut',
-    status: 'error',
-    color: 'sky',
-    accounts: [
-      { label: 'Compte courant $', balance: 0, currency: '$', status: 'disabled' },
-      { label: 'Compte courant €', balance: 17.6, currency: '€', status: 'error' },
-    ],
-    transactions: [
-      { date: '2024-08-01', libelle: 'FACTURE FOURNISSEUR A', categorie: 'Fournisseur alimentaire', montant: 2200.0, mois: '2024-08', type: 'Sortie' },
-      { date: '2024-08-05', libelle: 'VERSEMENT CAF', categorie: 'Encaissement', montant: 3600.0, mois: '2024-08', type: 'Entrée' },
-      { date: '2024-08-10', libelle: 'PRLV SEPA ENGIE', categorie: 'Électricité', montant: 320.45, mois: '2024-08', type: 'Sortie' },
-      { date: '2024-08-15', libelle: 'PRLV SEPA URSSAF', categorie: 'Charges sociales', montant: 510.0, mois: '2024-08', type: 'Sortie' },
-      { date: '2024-08-18', libelle: 'VIR SEPA GESTION STOCK', categorie: 'Fournisseur', montant: 1400.0, mois: '2024-08', type: 'Sortie' },
-      { date: '2024-08-25', libelle: 'VERSEMENT NOUTAM', categorie: 'Encaissement', montant: 4200.0, mois: '2024-08', type: 'Entrée' },
-    ],
-  },
-};
-
-const FALLBACK_ACCOUNT_LIST = Object.entries(ACCOUNT_DATA).map(([key, meta]) => {
-  const flux = (meta.transactions ?? []).reduce(
-    (acc, tx) => {
-      if (tx.type === 'Entrée') {
-        acc.inflow += tx.montant || 0;
-      } else {
-        acc.outflow += tx.montant || 0;
-      }
-      acc.operations += 1;
-      return acc;
-    },
-    { inflow: 0, outflow: 0, operations: 0 },
-  );
-  return {
-    value: key,
-    label: meta.label,
-    provider: meta.provider,
-    status: meta.status,
-    balance: (meta.accounts ?? []).reduce((sum, account) => sum + (account.balance || 0), 0),
-    currency: 'EUR',
-    inflow: flux.inflow,
-    outflow: flux.outflow,
-    operations: flux.operations,
-    subAccounts: meta.accounts ?? [],
-  };
-});
-
-const STATUS_PRIORITY = {
-  error: 4,
-  warning: 3,
-  disconnected: 2,
-  connected: 1,
-  disabled: 0,
-};
-
-const buildAggregatedAccount = (accounts) => {
-  if (!accounts.length) {
-    return null;
-  }
-  const aggregated = accounts.reduce(
-    (acc, entry) => {
-      acc.balance += entry.balance || 0;
-      acc.inflow += entry.inflow || 0;
-      acc.outflow += entry.outflow || 0;
-      acc.operations += entry.operations || 0;
-      if (entry.lastActivity) {
-        const current = new Date(entry.lastActivity);
-        if (!acc.lastActivity || current > acc.lastActivity) {
-          acc.lastActivity = current;
-        }
-      }
-      const weight = STATUS_PRIORITY[entry.status] ?? 0;
-      if (weight > acc.statusWeight) {
-        acc.status = entry.status;
-        acc.statusWeight = weight;
-      }
-      return acc;
-    },
-    {
-      value: 'all',
-      label: 'Tous les comptes',
-      provider: 'Consolidé',
-      status: 'connected',
-      statusWeight: STATUS_PRIORITY.connected,
-      balance: 0,
-      inflow: 0,
-      outflow: 0,
-      operations: 0,
-      currency: 'EUR',
-      subAccounts: [],
-      lastActivity: null,
-    },
-  );
-  if (aggregated.lastActivity instanceof Date) {
-    aggregated.lastActivity = aggregated.lastActivity.toISOString().slice(0, 10);
-  }
-  delete aggregated.statusWeight;
-  return aggregated;
-};
-
-const normalizeDateInput = (value) => {
-  if (!value) return null;
-  let cleaned = value.trim();
-  if (!cleaned) return null;
-  cleaned = cleaned.replace(/[.]/g, '/').replace(/-/g, '/');
-  const segments = cleaned.split('/');
-  if (segments.length === 3) {
-    let [day, month, year] = segments;
-    if (year.length === 2) {
-      year = `20${year}`;
-    }
-    return `${year.padStart(4, '0')}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
-  }
-  const parsed = new Date(cleaned);
-  if (!Number.isNaN(parsed.getTime())) {
-    return parsed.toISOString().slice(0, 10);
-  }
-  return null;
-};
-
-const parserLine = (line) => {
-  const parts = line.split(';').map(part => part.trim());
-  if (parts.length < 5) return null;
-  const normalizedDate = normalizeDateInput(parts[0]);
-  return {
-    date: normalizedDate,
-    libelle: parts[1],
-    categorie: parts[2] || 'Autres',
-    montant: parseFloat(parts[3].replace(',', '.')) || 0,
-    mois: parts[4] || (normalizedDate ? normalizedDate.slice(0, 7) : ''),
-    type: (parts[5] || 'Sortie'),
-  };
-};
-
-const BankStatementAnalyzer = ({ defaultAccount = 'incontournable' }) => {
-  const [selectedMonth, setSelectedMonth] = useState('all');
-  const [selectedCategory, setSelectedCategory] = useState('all');
-  const [viewMode, setViewMode] = useState('table');
-  const [selectedAccount, setSelectedAccount] = useState(defaultAccount);
-  const [manualInput, setManualInput] = useState('');
-  const [fileError, setFileError] = useState('');
-  const [pdfInfo, setPdfInfo] = useState('');
-  const [editableTransaction, setEditableTransaction] = useState(null);
-  const [summaryMonths, setSummaryMonths] = useState('all');
-  const [summaryResolution, setSummaryResolution] = useState('monthly');
-  const [groupingPreset, setGroupingPreset] = useState('default');
-  const bankAccountsQuery = useRestaurantBankAccountsOverview();
-  const serverAccountCards = useMemo(
-    () =>
-      (bankAccountsQuery.data ?? []).map((entry, index) => ({
-        value: entry.account || entry.display_name || `compte-${index}`,
-        label: entry.display_name || entry.account || `Compte ${index + 1}`,
-        provider: entry.provider || 'Compte',
-        status: entry.status || 'connected',
-        balance: Number(entry.balance ?? 0),
-        inflow: Number(entry.inflow ?? 0),
-        outflow: Number(entry.outflow ?? 0),
-        operations: Number(entry.operations ?? 0),
-        currency: entry.currency || 'EUR',
-        lastActivity: entry.last_activity || null,
-        subAccounts: [],
-      })),
-    [bankAccountsQuery.data],
-  );
-  const hasServerAccounts = serverAccountCards.length > 0;
-  const accountCards = hasServerAccounts ? serverAccountCards : FALLBACK_ACCOUNT_LIST;
-  const aggregatedAccountMeta = useMemo(
-    () => (hasServerAccounts ? buildAggregatedAccount(serverAccountCards) : null),
-    [hasServerAccounts, serverAccountCards],
-  );
-  const allowAllAccounts = hasServerAccounts && serverAccountCards.length > 1;
-  const accountMap = useMemo(() => {
-    const entries = new Map();
-    accountCards.forEach((card) => entries.set(card.value, card));
-    if (aggregatedAccountMeta) {
-      entries.set('all', aggregatedAccountMeta);
-    }
-    return entries;
-  }, [accountCards, aggregatedAccountMeta]);
-
-  useEffect(() => {
-    if (!accountCards.length) {
-      return;
-    }
-    if (selectedAccount === 'all' && !allowAllAccounts) {
-      setSelectedAccount(accountCards[0].value);
-      return;
-    }
-    const exists = selectedAccount && (selectedAccount === 'all' ? allowAllAccounts : accountMap.has(selectedAccount));
-    if (!exists) {
-      if (allowAllAccounts) {
-        setSelectedAccount('all');
-      } else {
-        setSelectedAccount(accountCards[0].value);
-      }
-    }
-  }, [accountCards, accountMap, allowAllAccounts, selectedAccount]);
-
-  const selectedAccountQuery = selectedAccount === 'all' ? undefined : selectedAccount;
-  const bankStatements = useRestaurantBankStatements(selectedAccountQuery);
-  const createBankStatement = useCreateRestaurantBankStatement();
-  const updateBankStatement = useUpdateRestaurantBankStatement();
-  const importBankStatementsPdf = useImportRestaurantBankStatementsPdf();
-  const categoriesQuery = useRestaurantCategories();
-  const costCentersQuery = useRestaurantCostCenters();
-  const createExpenseFromStatement = useCreateExpenseFromBankStatement();
-  const [expenseModal, setExpenseModal] = useState(null);
-  const [expenseError, setExpenseError] = useState('');
-  const isAllWindow = summaryMonths === 'all';
-  const summaryMonthsValue = isAllWindow ? 0 : Number(summaryMonths);
-  const bankSummary = useRestaurantBankStatementSummary(selectedAccountQuery, summaryMonthsValue, groupingPreset);
-  const bankSummaryAll = useRestaurantBankStatementSummary(undefined, summaryMonthsValue, groupingPreset);
-  // Fallback: if the selected account has no groups, fall back to aggregated (all accounts) to avoid empty graphs
-  const summaryDataRaw = bankSummary.data;
-  const summaryData =
-    summaryDataRaw?.groups?.length || !allowAllAccounts ? summaryDataRaw : bankSummaryAll.data;
-  const groupingOptions = useMemo(() => {
-    if (summaryData?.presets?.length) {
-      return summaryData.presets;
-    }
-    return [{ name: 'default', label: 'Vue standard', groups: [] }];
-  }, [summaryData]);
-  const summaryLoading = bankSummary.isLoading || bankSummary.isFetching;
-  const forecastValue = summaryData?.forecast_next_month ?? null;
-
-  const showSampleData = import.meta.env.VITE_SHOW_SAMPLE_BANK_STATEMENTS === 'true';
-  const allowSampleData = showSampleData && !hasServerAccounts;
-  const fallbackTransactions = useMemo(() => {
-    if (!allowSampleData) {
-      return [];
-    }
-    const seedTransactions = ACCOUNT_DATA[selectedAccount]?.transactions ?? [];
-    return seedTransactions.map((tx, index) => ({
-      ...tx,
-      uid: `${selectedAccount}-seed-${index}-${tx.date}-${tx.montant}`,
-    }));
-  }, [allowSampleData, selectedAccount]);
-  const serverTransactions = bankStatements.data ?? [];
-  const transactions = useMemo(() => {
-    if (serverTransactions.length === 0) {
-      return allowSampleData ? fallbackTransactions : [];
-    }
-    return serverTransactions.map((tx) => ({ ...tx, uid: `bank-${tx.id}` }));
-  }, [serverTransactions, fallbackTransactions, allowSampleData]);
-  const scopedTransactions = useMemo(() => {
-    if (isAllWindow) {
-      return transactions;
-    }
-    const now = new Date();
-    const currentIndex = now.getUTCFullYear() * 12 + now.getUTCMonth();
-    const minIndex = currentIndex - summaryMonthsValue + 1;
-    return transactions.filter((tx) => {
-      const rawMonth = tx.mois || (tx.date ? tx.date.slice(0, 7) : null);
-      if (!rawMonth) return false;
-      const [yearStr, monthStr] = rawMonth.split('-');
-      const year = Number(yearStr);
-      const month = Number(monthStr);
-      if (Number.isNaN(year) || Number.isNaN(month)) {
-        return false;
-      }
-      const idx = year * 12 + (month - 1);
-      return idx >= minIndex;
-    });
-  }, [transactions, summaryMonthsValue, isAllWindow]);
-
-  useEffect(() => {
-    setEditableTransaction(null);
-  }, [selectedAccount]);
-
-  useEffect(() => {
-    setSelectedAccount(defaultAccount);
-  }, [defaultAccount]);
-
-  useEffect(() => {
-    if (!groupingOptions?.length) return;
-    if (!groupingOptions.some((preset) => preset.name === groupingPreset)) {
-      setGroupingPreset(groupingOptions[0].name);
-    }
-  }, [groupingOptions, groupingPreset]);
-
-  const fallbackTimelines = useMemo(
-    () => ({
-      monthly: aggregateTimeline(scopedTransactions, 'monthly'),
-      weekly: aggregateTimeline(scopedTransactions, 'weekly'),
-      daily: aggregateTimeline(scopedTransactions, 'daily'),
-    }),
-    [scopedTransactions],
-  );
-
-  const timelineStats = useMemo(() => {
-    if (summaryData) {
-      const server = {
-        monthly: summaryData.monthly ?? [],
-        weekly: summaryData.weekly ?? [],
-        daily: summaryData.daily ?? [],
-      };
-      if (server[summaryResolution]?.length) {
-        return server[summaryResolution];
-      }
-    }
-    return fallbackTimelines[summaryResolution] ?? [];
-  }, [summaryData, summaryResolution, fallbackTimelines]);
-
-  const availableCash = useMemo(
-    () =>
-      scopedTransactions.reduce(
-        (sum, transaction) => sum + (transaction.type === 'Entrée' ? transaction.montant : -transaction.montant),
-        0,
-      ),
-    [scopedTransactions],
-  );
-
-  const currentPeriod = timelineStats.length ? timelineStats[timelineStats.length - 1] : null;
-  const inflowCurrent = currentPeriod?.entrees ?? 0;
-  const outflowCurrent = currentPeriod?.sorties ?? 0;
-
-  const vatBalance = useMemo(
-    () =>
-      scopedTransactions
-        .filter((tx) => (tx.categorie || '').toLowerCase().includes('tva'))
-        .reduce((sum, tx) => sum + (tx.type === 'Entrée' ? tx.montant : -tx.montant), 0),
-    [scopedTransactions],
-  );
-
-  const resolutionLabel =
-    SUMMARY_RESOLUTION_OPTIONS.find((option) => option.value === summaryResolution)?.label ?? 'Mensuel';
-
-  const formatTimelineLabel = (stat) => {
-    if (summaryResolution === 'weekly') {
-      return stat.semaine;
-    }
-    if (summaryResolution === 'daily') {
-      return stat.jour;
-    }
-    return stat.mois;
-  };
-
-  const formatTimelineSubLabel = (stat) => {
-    if (summaryResolution === 'weekly' && stat.start_date && stat.end_date) {
-      return `${stat.start_date} → ${stat.end_date}`;
-    }
-    return null;
-  };
-
-  const kpiCards = [
-    {
-      label: 'Trésorerie disponible',
-      value: formatCurrency(availableCash),
-      accent: availableCash >= 0 ? 'text-emerald-700' : 'text-rose-600',
-    },
-    {
-      label: 'Encaissements du mois',
-      value: formatCurrency(inflowCurrent),
-      accent: 'text-emerald-700',
-      hint: currentPeriod ? `Période ${formatTimelineLabel(currentPeriod)}` : undefined,
-    },
-    {
-      label: 'Décaissements du mois',
-      value: formatCurrency(outflowCurrent),
-      accent: 'text-rose-600',
-      hint: currentPeriod ? `Période ${formatTimelineLabel(currentPeriod)}` : undefined,
-    },
-    {
-      label: 'Solde TVA',
-      value: formatCurrency(vatBalance),
-      accent: vatBalance >= 0 ? 'text-emerald-700' : 'text-rose-600',
-      hint: 'Catégories contenant “TVA”',
-    },
-  ];
-
-  const categoryTimelineMap = useMemo(
-    () => buildCategoryBuckets(scopedTransactions, summaryResolution),
-    [scopedTransactions, summaryResolution],
-  );
-
-  const topCategoryKeys = useMemo(() => {
-    const totals = {};
-    categoryTimelineMap.forEach((breakdown) => {
-      Object.entries(breakdown).forEach(([category, amount]) => {
-        totals[category] = (totals[category] || 0) + amount;
-      });
-    });
-    return Object.entries(totals)
-      .sort((a, b) => b[1] - a[1])
-      .slice(0, 5)
-      .map(([category]) => category);
-  }, [categoryTimelineMap]);
-
-  const stackedCategoryKeys = useMemo(() => {
-    const keys = [...topCategoryKeys];
-    if (!keys.includes('Autres')) {
-      keys.push('Autres');
-    }
-    return keys;
-  }, [topCategoryKeys]);
-
-  const timelineChartData = useMemo(
-    () =>
-      timelineStats.map((stat) => ({
-        label: formatTimelineLabel(stat) ?? 'Période',
-        entrees: roundAmount(stat.entrees ?? 0),
-        sorties: roundAmount(stat.sorties ?? 0),
-        net: roundAmount(stat.net ?? 0),
-      })),
-    [timelineStats, summaryResolution],
-  );
-
-  const categoryChartData = useMemo(() => {
-    if (!timelineStats.length) return [];
-    return timelineStats.map((stat) => {
-      const label = formatTimelineLabel(stat) ?? 'Période';
-      const breakdown = categoryTimelineMap.get(label) || {};
-      const row = { label };
-      let other = 0;
-      Object.entries(breakdown).forEach(([category, amount]) => {
-        if (topCategoryKeys.includes(category)) {
-          row[category] = roundAmount(amount);
-        } else {
-          other += amount;
-        }
-      });
-      row.Autres = roundAmount(other);
-      return row;
-    });
-  }, [timelineStats, categoryTimelineMap, topCategoryKeys, summaryResolution]);
-
-  const categoryCards = useMemo(
-    () =>
-      timelineStats.map((stat) => {
-        const label = formatTimelineLabel(stat) ?? 'Période';
-        const breakdown = categoryTimelineMap.get(label) || {};
-        const total = Object.values(breakdown).reduce((sum, value) => sum + value, 0);
-        const topEntries = Object.entries(breakdown)
-          .sort((a, b) => b[1] - a[1])
-          .slice(0, 3)
-          .map(([category, amount]) => ({ category, amount: roundAmount(amount) }));
-        return {
-          label,
-          total: roundAmount(total),
-          entries: topEntries,
-        };
-      }),
-    [timelineStats, categoryTimelineMap, summaryResolution],
-  );
-
-  const categoryColorMap = useMemo(() => {
-    const palette = CATEGORY_COLOR_PALETTE;
-    const unique = [...new Set(scopedTransactions.map(t => t.categorie || 'Autres charges'))];
-    return unique.reduce((acc, category, index) => {
-      acc[category] = palette[index % palette.length];
-      return acc;
-    }, {});
-  }, [scopedTransactions]);
-
-  const fallbackCategoryStats = useMemo(() => {
-    const stats = {};
-    scopedTransactions.forEach(t => {
-      if (t.type !== 'Sortie') return;
-      const group = t.categorie || 'Autres charges';
-      if (!stats[group]) stats[group] = { groupe: group, montant: 0 };
-      stats[group].montant += t.montant;
-    });
-    return Object.values(stats).sort((a, b) => b.montant - a.montant);
-  }, [scopedTransactions]);
-
-  const categoryStats = useMemo(() => {
-    if (summaryData?.groups?.length) {
-      return summaryData.groups.map((group) => ({
-        groupe: group.group,
-        montant: group.sorties,
-        entrees: group.entrees,
-        net: group.net,
-      }));
-    }
-    return fallbackCategoryStats;
-  }, [summaryData, fallbackCategoryStats]);
-
-  const selectedAccountMeta = selectedAccount ? accountMap.get(selectedAccount) : null;
-  const asideAccountCards = useMemo(() => {
-    if (allowAllAccounts && aggregatedAccountMeta) {
-      return [aggregatedAccountMeta, ...accountCards];
-    }
-    return accountCards;
-  }, [accountCards, allowAllAccounts, aggregatedAccountMeta]);
-  const accountFilterOptions = useMemo(() => {
-    const base = accountCards.map((card) => ({ value: card.value, label: card.label }));
-    if (allowAllAccounts && aggregatedAccountMeta) {
-      return [{ value: 'all', label: aggregatedAccountMeta.label }, ...base];
-    }
-    return base;
-  }, [accountCards, allowAllAccounts, aggregatedAccountMeta]);
-
-  const filteredTransactions = useMemo(() => {
-    return scopedTransactions.filter(t => {
-      if (selectedMonth !== 'all' && t.mois !== selectedMonth) return false;
-      if (selectedCategory !== 'all' && t.categorie !== selectedCategory) return false;
-      return true;
-    });
-  }, [scopedTransactions, selectedMonth, selectedCategory]);
-
-  const persistEntries = async (entries) => {
-    if (!selectedAccount || selectedAccount === 'all') {
-      throw new Error('Sélectionnez un compte bancaire précis avant l’import.');
-    }
-    const payloads = entries
-      .filter((entry) => entry.date && entry.mois)
-      .map((entry) => ({
-        account: selectedAccount,
-        date: entry.date,
-        libelle: entry.libelle,
-        categorie: entry.categorie,
-        montant: entry.montant,
-        type: entry.type,
-        mois: entry.mois || entry.date.slice(0, 7),
-      }));
-    if (!payloads.length) {
-      throw new Error('Aucune ligne valide à enregistrer');
-    }
-    await Promise.all(payloads.map((payload) => createBankStatement.mutateAsync(payload)));
-  };
-
-  const handleManualSubmit = async (event) => {
-    event.preventDefault();
-    if (!selectedAccount || selectedAccount === 'all') {
-      setFileError('Sélectionnez un compte précis avant d’enregistrer des lignes.');
-      return;
-    }
-    const lines = manualInput.split('\n').map((line) => line.trim()).filter(Boolean);
-    const parsed = lines.map(parserLine).filter(Boolean);
-    if (!parsed.length) return;
-    try {
-      await persistEntries(parsed);
-      setManualInput('');
-      setFileError('');
-      setPdfInfo('');
-    } catch (error) {
-      setFileError('Impossible d’enregistrer les relevés. Réessaye plus tard.');
-    }
-  };
-
-const handleFileUpload = (event) => {
-    setFileError('');
-    if (!selectedAccount || selectedAccount === 'all') {
-      setFileError('Sélectionnez un compte précis avant d’importer un fichier.');
-      return;
-    }
-    const file = event.target.files?.[0];
-    if (!file) return;
-    const reader = new FileReader();
-    reader.onload = async () => {
-      const text = reader.result;
-      if (typeof text !== 'string') {
-        setFileError('Fichier introuvable ou illisible.');
-        return;
-      }
-      const rows = text.split(/\r?\n/).map((row) => row.trim()).filter(Boolean);
-      const parsed = rows.map(parserLine).filter(Boolean);
-      if (!parsed.length) {
-        setFileError('Aucune ligne valide détectée (format : date;libellé;categorie;montant;mois;type).');
-        return;
-      }
-      try {
-        await persistEntries(parsed);
-        setPdfInfo('');
-      } catch (error) {
-        setFileError('Impossible d’enregistrer les relevés. Réessaye plus tard.');
-      }
-    };
-  reader.onerror = () => setFileError('Impossible de lire le fichier.');
-  reader.readAsText(file, 'utf-8');
-};
-
-  const handlePdfUpload = async (event) => {
-    setPdfInfo('');
-    if (!selectedAccount || selectedAccount === 'all') {
-      setFileError('Sélectionnez un compte précis avant d’importer un PDF.');
-      return;
-    }
-    const file = event.target.files?.[0];
-    if (!file) return;
-    try {
-      const result = await importBankStatementsPdf.mutateAsync({ account: selectedAccount, file });
-      setPdfInfo(`${result.inserted} mouvements ajoutés (${result.total} détectés${result.duplicates ? `, ${result.duplicates} doublon(s)` : ''}).`);
-      setFileError('');
-    } catch (error) {
-      setFileError("Impossible d'importer le PDF. Vérifiez le format.");
-    } finally {
-      event.target.value = '';
-    }
-  };
-
-  const handlePrepareEdit = (transaction) => {
-    if (!transaction.id) return;
-    setEditableTransaction({ ...transaction });
-  };
-
-  const handleEditChange = (field, value) => {
-    setEditableTransaction((prev) => (prev ? { ...prev, [field]: value } : prev));
-  };
-
-  const handleEditSubmit = async (event) => {
-    event.preventDefault();
-    if (!editableTransaction?.id) return;
-    try {
-      await updateBankStatement.mutateAsync({
-        entryId: editableTransaction.id,
-        payload: {
-          account: editableTransaction.account,
-          date: editableTransaction.date,
-          libelle: editableTransaction.libelle,
-          categorie: editableTransaction.categorie,
-          montant: Number(editableTransaction.montant),
-          type: editableTransaction.type,
-          mois: editableTransaction.mois,
-        },
-      });
-      setEditableTransaction(null);
-      setFileError('');
-    } catch (error) {
-      setFileError('Impossible de mettre à jour le relevé.');
-    }
-  };
-
-  const handleEditCancel = () => {
-    setEditableTransaction(null);
-  };
-
-  const handleOpenExpenseModal = (transaction) => {
-    if (!transaction) return;
-    setExpenseError('');
-    setExpenseModal({
-      entry: transaction,
-      form: {
-        libelle: transaction.libelle || '',
-        date_operation: transaction.date || '',
-        montant_ht: Math.abs(transaction.montant || 0),
-        categorie_id: null,
-        cost_center_id: null,
-        fournisseur_id: null,
-        tva_pct: 20,
-      },
-    });
-  };
-
-  const handleCloseExpenseModal = () => {
-    setExpenseModal(null);
-    setExpenseError('');
-  };
-
-  const handleExpenseFieldChange = (field, value) => {
-    setExpenseModal((prev) => (prev ? { ...prev, form: { ...prev.form, [field]: value } } : prev));
-  };
-
-  const handleExpenseSubmit = async (event) => {
-    event.preventDefault();
-    if (!expenseModal?.entry) return;
-    setExpenseError('');
-    try {
-      const payload = {
-        ...expenseModal.form,
-        libelle: expenseModal.form.libelle?.trim() || expenseModal.entry.libelle,
-        montant_ht: expenseModal.form.montant_ht ? parseFloat(expenseModal.form.montant_ht) : undefined,
-      };
-      if (!payload.montant_ht) {
-        payload.montant_ht = Math.abs(expenseModal.entry.montant || 0);
-      }
-      await createExpenseFromStatement.mutateAsync({
-        entryId: expenseModal.entry.id,
-        payload,
-        account: selectedAccount,
-      });
-      handleCloseExpenseModal();
-    } catch (error) {
-      setExpenseError("Impossible de créer la dépense à partir du relevé.");
-    }
-  };
-
-  const exportToCSV = () => {
-    const headers = ['Date', 'Libellé', 'Catégorie', 'Montant', 'Type', 'Mois'];
-    const rows = filteredTransactions.map(t => [
-      t.date,
-      t.libelle,
-      t.categorie,
-      t.montant.toFixed(2),
-      t.type,
-      t.mois,
-    ]);
-    const csv = [headers, ...rows].map(row => row.join(';')).join('\n');
-    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
-    const link = document.createElement('a');
-    link.href = URL.createObjectURL(blob);
-    link.download = `releves-${selectedMonth}.csv`;
-    link.click();
-  };
-
-  const months = useMemo(() => [...new Set(scopedTransactions.map(t => t.mois))].sort(), [scopedTransactions]);
-  const categoriesFilter = useMemo(() => [...new Set(scopedTransactions.map(t => t.categorie))].sort(), [scopedTransactions]);
-  const categoryOptions = categoriesQuery.data ?? [];
-  const costCenterOptions = costCentersQuery.data ?? [];
-
-  const totalEntrées = filteredTransactions.filter(t => t.type === 'Entrée').reduce((sum, t) => sum + t.montant, 0);
-  const totalSorties = filteredTransactions.filter(t => t.type === 'Sortie').reduce((sum, t) => sum + t.montant, 0);
 
+// Composant simplifié pour éviter tout crash lié aux hooks/dépendances.
+export default function BankStatementAnalyzer() {
   return (
     <div className="min-h-screen bg-slate-50 p-6">
-      <div className="mx-auto flex w-full max-w-6xl flex-col gap-6">
-        <div className="grid gap-6 lg:grid-cols-[320px,1fr]">
-          <aside className="flex flex-col gap-4">
-            <Card className="flex flex-col gap-4">
-              <div className="flex items-center justify-between">
-                <div>
-                  <p className="text-xs uppercase tracking-[0.3em] text-slate-400">Comptes bancaires</p>
-                  <p className="text-sm text-slate-500">Centralisez vos flux et vos cartes</p>
-                </div>
-                {selectedAccountMeta && (
-                  <StatusBadge status={selectedAccountMeta.status}>{selectedAccountMeta.status}</StatusBadge>
-                )}
-              </div>
-              <div className="flex flex-col gap-3">
-                {asideAccountCards.length ? (
-                  asideAccountCards.map((meta) => {
-                    const isActive = meta.value === selectedAccount;
-                    const hasBreakdown = (meta.subAccounts ?? []).length > 0;
-                    return (
-                      <button
-                        key={meta.value}
-                        type="button"
-                        onClick={() => setSelectedAccount(meta.value)}
-                        className={`rounded-2xl border px-4 py-3 text-left transition ${
-                          isActive ? 'border-slate-900 bg-white shadow-sm' : 'border-slate-200 bg-slate-50 hover:border-slate-300'
-                        }`}
-                      >
-                        <div className="flex items-center justify-between gap-2">
-                          <div>
-                            <p className="text-xs uppercase tracking-[0.3em] text-slate-400">{meta.provider}</p>
-                            <p className="text-sm font-semibold text-slate-900">{meta.label}</p>
-                          </div>
-                          {meta.status && <StatusBadge status={meta.status}>{meta.status}</StatusBadge>}
-                        </div>
-                        <p className="mt-3 text-xs uppercase tracking-[0.3em] text-slate-400">Solde agrégé</p>
-                        <p className="text-lg font-semibold text-slate-900">{formatCurrency(meta.balance || 0)}</p>
-                        <div className="mt-3 space-y-1 text-xs text-slate-600">
-                          {hasBreakdown ? (
-                            meta.subAccounts.map((account) => (
-                              <div key={`${meta.value}-${account.label}`} className="flex items-center justify-between">
-                                <div className="flex items-center gap-2">
-                                  <span
-                                    className={`inline-flex h-4 w-7 rounded-full border transition ${
-                                      account.status === 'disabled'
-                                        ? 'border-slate-200 bg-slate-100'
-                                        : account.status === 'error'
-                                          ? 'border-rose-200 bg-rose-100'
-                                          : 'border-emerald-200 bg-emerald-100'
-                                    }`}
-                                  />
-                                  {account.label}
-                                </div>
-                                <span className="font-semibold text-slate-900">{formatCurrency(account.balance || 0)}</span>
-                              </div>
-                            ))
-                          ) : (
-                            <>
-                              {(meta.inflow || meta.outflow) && (
-                                <p>
-                                  Flux {formatCurrency(meta.inflow || 0)} / {formatCurrency(meta.outflow || 0)}
-                                </p>
-                              )}
-                              {meta.operations ? <p>{meta.operations} opérations suivies</p> : null}
-                              {meta.lastActivity && <p>Dernier mouvement {meta.lastActivity}</p>}
-                            </>
-                          )}
-                        </div>
-                      </button>
-                    );
-                  })
-                ) : (
-                  <p className="text-sm text-slate-500">Aucun compte relié pour l’instant.</p>
-                )}
-              </div>
-              <div className="mt-4 flex gap-2">
-                <Button variant="ghost" className="flex-1 justify-center text-sm">
-                  Gérer les comptes
-                </Button>
-                <Button variant="brand" className="flex-1 justify-center text-sm">
-                  Ajouter une banque
-                </Button>
-              </div>
-            </Card>
-            <GuidedTip
-              title="Synchronisation temps réel"
-              description="Connectez vos comptes et cartes pour alimenter automatiquement vos relevés et vos prévisions."
-            />
-            <GuidedTip
-              title="Catégorisation intelligente"
-              description="Modifiez vos catégories à tout moment : vos dashboards se mettent à jour instantanément."
-            />
-          </aside>
-          <div className="space-y-6">
-            <header className="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
-              <div className="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
-                <div className="flex items-center gap-3">
-                  <TrendingDown className="h-10 w-10 text-blue-600" />
-                  <div>
-                    <p className="text-xs uppercase tracking-[0.4em] text-slate-500">Restaurant HQ</p>
-                    <h1 className="text-3xl font-semibold text-slate-900">Relevés bancaires détaillés</h1>
-                    <p className="text-sm text-slate-500">
-                      Compte sélectionné : {selectedAccountMeta?.label ?? selectedAccount}
-                    </p>
-                  </div>
-                </div>
-                <Button variant="ghost" className="inline-flex items-center gap-2" onClick={exportToCSV}>
-                  <Download className="h-4 w-4" />
-                  Export CSV
-                </Button>
-              </div>
-              <div className="mt-4 grid gap-3 md:grid-cols-2 lg:grid-cols-4">
-                {kpiCards.map((kpi) => (
-                  <KpiCard key={kpi.label} label={kpi.label} value={kpi.value} hint={kpi.hint} accent={kpi.accent} />
-                ))}
-              </div>
-            </header>
-
-        <section className="grid gap-4 md:grid-cols-2">
-          <div className="rounded-xl border border-slate-200 bg-white p-4 shadow-sm flex flex-col gap-4">
-            <h2 className="text-lg font-semibold text-slate-900 mb-3 flex items-center gap-2">
-              <Calendar className="w-4 h-4 text-blue-600" />
-              Chronologie & prévisions
-              <span className="text-xs font-normal text-slate-400 uppercase tracking-wide">
-                {resolutionLabel}
-              </span>
-            </h2>
-            {summaryLoading && <p className="text-xs text-slate-400">Calcul en cours...</p>}
-            {!summaryLoading && forecastValue !== null && (
-              <p className="text-xs text-slate-500">
-                Prévision prochaine période : <span className="font-semibold">{forecastValue.toFixed(2)} €</span>
-              </p>
-            )}
-            {timelineChartData.length > 0 && (
-              <div className="h-56 w-full">
-                <ResponsiveContainer width="100%" height="100%">
-                  <AreaChart data={timelineChartData} margin={{ left: 0, right: 0, top: 10, bottom: 0 }}>
-                    <defs>
-                      <linearGradient id="colorNet" x1="0" y1="0" x2="0" y2="1">
-                        <stop offset="5%" stopColor="#0ea5e9" stopOpacity={0.8} />
-                        <stop offset="95%" stopColor="#0ea5e9" stopOpacity={0} />
-                      </linearGradient>
-                    </defs>
-                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
-                    <XAxis dataKey="label" tick={{ fontSize: 11 }} />
-                    <YAxis tick={{ fontSize: 11 }} />
-                    <Tooltip formatter={(value) => `${Number(value).toFixed(2)} €`} />
-                    <Legend />
-                    <Area type="monotone" dataKey="entrees" stroke="#22c55e" fill="#22c55e" fillOpacity={0.15} name="Entrées" />
-                    <Area type="monotone" dataKey="sorties" stroke="#ef4444" fill="#ef4444" fillOpacity={0.1} name="Sorties" />
-                    <Area type="monotone" dataKey="net" stroke="#0ea5e9" fill="url(#colorNet)" name="Résultat" />
-                  </AreaChart>
-                </ResponsiveContainer>
-              </div>
-            )}
-            <div className="space-y-3">
-              {timelineStats.length === 0 && !summaryLoading && (
-                <p className="text-sm text-slate-500">Aucune donnée sur la période sélectionnée.</p>
-              )}
-              {timelineStats.map((stat, index) => {
-                const label = formatTimelineLabel(stat) ?? `periode-${index}`;
-                const extra = formatTimelineSubLabel(stat);
-                const scaleBase = summaryResolution === 'daily' ? 200 : summaryResolution === 'weekly' ? 800 : 1500;
-                const progress = Math.min(Math.abs(stat.net || 0) / scaleBase, 1) * 100;
-                return (
-                  <div key={`${summaryResolution}-${label}-${index}`} className="space-y-1">
-                    <div className="flex items-center justify-between text-sm text-slate-600">
-                      <span>{label}</span>
-                      <span>{stat.net.toFixed(2)} €</span>
-                    </div>
-                    {extra && <p className="text-xs text-slate-400">{extra}</p>}
-                    <div className="h-2 rounded-full bg-slate-100">
-                      <div
-                        className="h-full rounded-full bg-gradient-to-r from-emerald-500 to-blue-500"
-                        style={{ width: `${progress}%` }}
-                      />
-                    </div>
-                  </div>
-                );
-              })}
-            </div>
-          </div>
-          <div className="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
-            <h2 className="text-lg font-semibold text-slate-900 mb-3 flex items-center gap-2">
-              <Filter className="w-4 h-4 text-blue-600" />
-              Répartition par groupe
-            </h2>
-            {summaryLoading && <p className="text-xs text-slate-400">Calcul en cours...</p>}
-            {categoryChartData.length > 0 && (
-              <div className="h-64 w-full mb-4">
-                <ResponsiveContainer width="100%" height="100%">
-                  <BarChart data={categoryChartData} margin={{ left: 0, right: 0, top: 10, bottom: 0 }}>
-                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
-                    <XAxis dataKey="label" tick={{ fontSize: 11 }} />
-                    <YAxis tick={{ fontSize: 11 }} />
-                    <Tooltip formatter={(value) => `${Number(value).toFixed(2)} €`} />
-                    <Legend />
-                    {stackedCategoryKeys.map((key, idx) => (
-                      <Bar
-                        key={key}
-                        dataKey={key}
-                        stackId="categories"
-                        fill={CATEGORY_COLOR_PALETTE[idx % CATEGORY_COLOR_PALETTE.length]}
-                      />
-                    ))}
-                  </BarChart>
-                </ResponsiveContainer>
-              </div>
-            )}
-            <div className="space-y-3">
-              {categoryStats.length === 0 && !summaryLoading && (
-                <p className="text-sm text-slate-500">Aucun groupe à afficher.</p>
-              )}
-              {categoryStats.map(group => (
-                <div key={group.groupe} className="space-y-1">
-                  <div className="flex items-center justify-between text-sm text-slate-600">
-                    <span>{group.groupe}</span>
-                    <span>{(group.montant ?? 0).toFixed(2)} €</span>
-                  </div>
-                  <div className="h-2 rounded-full bg-slate-100">
-                    <div
-                      className="h-full rounded-full bg-gradient-to-r from-rose-500 to-orange-500"
-                      style={{ width: `${Math.min((group.montant ?? 0) / 5000, 1) * 100}%` }}
-                    />
-                  </div>
-                </div>
-              ))}
-            </div>
-            <div className="mt-4 grid gap-2">
-              {categoryCards.length === 0 && !summaryLoading && (
-                <p className="text-xs text-slate-400">Aucune dépense détectée sur cette période.</p>
-              )}
-              {categoryCards.slice(-6).reverse().map((card) => (
-                <div key={`card-${card.label}`} className="rounded-lg border border-slate-200 p-3">
-                  <div className="flex items-center justify-between text-sm font-semibold text-slate-700">
-                    <span>{card.label}</span>
-                    <span>{card.total.toFixed(2)} €</span>
-                  </div>
-                  <div className="mt-2 flex flex-wrap gap-2">
-                    {card.entries.length === 0 && (
-                      <span className="text-xs text-slate-400">Aucune catégorie dominante</span>
-                    )}
-                    {card.entries.map((entry) => (
-                      <span
-                        key={`${card.label}-${entry.category}`}
-                        className="inline-flex items-center rounded-full bg-slate-100 px-2 py-1 text-xs text-slate-600"
-                      >
-                        <span
-                          className="mr-1 inline-block h-2 w-2 rounded-full"
-                          style={{ backgroundColor: categoryColorMap[entry.category] || '#94a3b8' }}
-                        />
-                        {entry.category}: {entry.amount.toFixed(2)} €
-                      </span>
-                    ))}
-                  </div>
-                </div>
-              ))}
-            </div>
-          </div>
-        </section>
-
-        <section className="grid gap-4 md:grid-cols-[1.1fr,0.9fr]">
-          <div className="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
-            <div className="flex items-center justify-between mb-4">
-              <h2 className="text-lg font-semibold text-slate-900 flex items-center gap-2">
-                <Eye className="w-4 h-4 text-blue-600" />
-                Analyse détaillée
-              </h2>
-              <div className="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">
-                <button className={`mr-2 ${viewMode === 'table' ? 'text-slate-900' : 'text-slate-400'}`} onClick={() => setViewMode('table')}>
-                  Table
-                </button>
-                |
-                <button className={`ml-2 ${viewMode === 'summary' ? 'text-slate-900' : 'text-slate-400'}`} onClick={() => setViewMode('summary')}>
-                  Résumé
-                </button>
-              </div>
-            </div>
-            <div className="flex flex-col gap-3 md:flex-row md:items-center md:flex-wrap">
-              <label className="text-sm font-semibold text-slate-600">
-                Mois
-                <select
-                  className="ml-3 rounded-full border border-slate-200 bg-white px-3 py-1 text-sm"
-                  value={selectedMonth}
-                  onChange={e => setSelectedMonth(e.target.value)}
-                >
-                  <option value="all">Tous</option>
-                  {months.map(month => (
-                    <option key={month} value={month}>
-                      {month}
-                    </option>
-                  ))}
-                </select>
-              </label>
-              <label className="text-sm font-semibold text-slate-600">
-                Catégorie
-                <select
-                  className="ml-3 rounded-full border border-slate-200 bg-white px-3 py-1 text-sm"
-                  value={selectedCategory}
-                  onChange={e => setSelectedCategory(e.target.value)}
-                >
-                  <option value="all">Toutes</option>
-                  {categoriesFilter.map(category => (
-                    <option key={category} value={category}>
-                      {category}
-                    </option>
-                  ))}
-                  </select>
-                </label>
-              <label className="text-sm font-semibold text-slate-600">
-                Compte
-                <select
-                  className="ml-3 rounded-full border border-slate-200 bg-white px-3 py-1 text-sm"
-                  value={selectedAccount}
-                  onChange={e => setSelectedAccount(e.target.value)}
-                >
-                  {accountFilterOptions.map((option) => (
-                    <option key={option.value} value={option.value}>
-                      {option.label}
-                    </option>
-                  ))}
-                </select>
-              </label>
-              <label className="text-sm font-semibold text-slate-600">
-                Fenêtre
-                <select
-                  className="ml-3 rounded-full border border-slate-200 bg-white px-3 py-1 text-sm"
-                  value={summaryMonths}
-                  onChange={e => setSummaryMonths(e.target.value)}
-                >
-                  {SUMMARY_MONTH_OPTIONS.map(option => (
-                    <option key={option.value} value={option.value}>
-                      {option.label}
-                    </option>
-                  ))}
-                </select>
-              </label>
-              <label className="text-sm font-semibold text-slate-600">
-                Granularité
-                <select
-                  className="ml-3 rounded-full border border-slate-200 bg-white px-3 py-1 text-sm"
-                  value={summaryResolution}
-                  onChange={e => setSummaryResolution(e.target.value)}
-                >
-                  {SUMMARY_RESOLUTION_OPTIONS.map(option => (
-                    <option key={option.value} value={option.value}>
-                      {option.label}
-                    </option>
-                  ))}
-                </select>
-              </label>
-              <label className="text-sm font-semibold text-slate-600">
-                Regroupement
-                <select
-                  className="ml-3 rounded-full border border-slate-200 bg-white px-3 py-1 text-sm"
-                  value={groupingPreset}
-                  onChange={e => setGroupingPreset(e.target.value)}
-                  disabled={summaryLoading}
-                >
-                  {groupingOptions.map(option => (
-                    <option key={option.name} value={option.name}>
-                      {option.label}
-                    </option>
-                  ))}
-                </select>
-              </label>
-            </div>
-            {viewMode === 'table' ? (
-              <div className="mt-4 overflow-x-auto">
-                <table className="min-w-full divide-y divide-slate-200 text-sm">
-                  <thead>
-                  <tr className="text-left text-xs uppercase tracking-widest text-slate-500">
-                    <th className="px-3 py-2">Date</th>
-                    <th className="px-3 py-2">Libellé</th>
-                    <th className="px-3 py-2">Catégorie</th>
-                    <th className="px-3 py-2">Montant</th>
-                    <th className="px-3 py-2">Mois</th>
-                    <th className="px-3 py-2">Type</th>
-                    <th className="px-3 py-2">Action</th>
-                  </tr>
-                  </thead>
-                  <tbody className="divide-y divide-slate-100">
-                    {filteredTransactions.map((t) => (
-                      <tr key={t.uid}>
-                        <td className="px-3 py-2 text-slate-700">{t.date}</td>
-                        <td className="px-3 py-2 text-slate-700">{t.libelle}</td>
-                        <td className="px-3 py-2">
-                          {t.categorie ? (
-                            <CategoryTag label={t.categorie} color={categoryColorMap[t.categorie] || '#94a3b8'} />
-                          ) : (
-                            <span className="text-slate-400">—</span>
-                          )}
-                        </td>
-                        <td className="px-3 py-2 text-slate-900 font-semibold">
-                          {t.type === 'Entrée' ? '+' : '-'}
-                          {t.montant.toFixed(2)} €
-                        </td>
-                        <td className="px-3 py-2 text-slate-600">{t.mois}</td>
-                        <td className="px-3 py-2">
-                          <span
-                            className={`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${
-                              t.type === 'Entrée' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
-                            }`}
-                          >
-                            {t.type}
-                          </span>
-                        </td>
-                        <td className="px-3 py-2">
-                          <div className="flex flex-col gap-2">
-                            <button
-                              type="button"
-                              disabled={!t.id}
-                              onClick={() => handlePrepareEdit(t)}
-                              className={`rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold ${
-                                t.id ? 'text-slate-600 hover:border-slate-900 hover:text-slate-900' : 'text-slate-300 cursor-not-allowed'
-                              }`}
-                            >
-                              Modifier
-                            </button>
-                            {t.depense_id ? (
-                              <span className="rounded-full bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700 text-center">
-                                Charge #{t.depense_id}
-                              </span>
-                            ) : (
-                              <button
-                                type="button"
-                                disabled={t.type !== 'Sortie'}
-                                onClick={() => handleOpenExpenseModal(t)}
-                                className={`rounded-full border border-amber-200 px-3 py-1 text-xs font-semibold ${
-                                  t.type === 'Sortie'
-                                    ? 'text-amber-700 hover:border-amber-500 hover:text-amber-900'
-                                    : 'text-slate-300 cursor-not-allowed'
-                                }`}
-                              >
-                                Créer charge
-                              </button>
-                            )}
-                          </div>
-                        </td>
-                      </tr>
-                    ))}
-                  </tbody>
-                </table>
-              </div>
-            ) : (
-              <div className="mt-4 space-y-2 text-sm text-slate-600">
-                <p>Total entrées : {totalEntrées.toFixed(2)} €</p>
-                <p>Total sorties : {totalSorties.toFixed(2)} €</p>
-                <p>Solde net : {(totalEntrées - totalSorties).toFixed(2)} €</p>
-              </div>
-            )}
-          </div>
-          <div className="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
-            <h3 className="text-lg font-semibold text-slate-900 mb-3 flex items-center gap-2">
-              <Download className="w-4 h-4 text-blue-600" />
-              Ajouter des relevés
-            </h3>
-            <form onSubmit={handleManualSubmit} className="space-y-3">
-              <textarea
-                value={manualInput}
-                onChange={e => setManualInput(e.target.value)}
-                placeholder="date;libellé;catégorie;montant;mois;type"
-                rows={4}
-                className="w-full rounded-xl border border-slate-200 p-3 text-sm"
-              />
-              {fileError && <p className="text-xs font-semibold text-rose-600">{fileError}</p>}
-              <div className="flex flex-col gap-2">
-                <input type="file" accept=".csv,.txt" onChange={handleFileUpload} className="text-sm text-slate-500" />
-                <button
-                  type="submit"
-                  className="inline-flex items-center justify-center rounded-full bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700"
-                >
-                  Ajouter depuis le texte
-                </button>
-              </div>
-            </form>
-            <p className="mt-3 text-xs text-slate-500">
-              Format CSV attendu: <span className="font-semibold">date;libellé;catégorie;montant;mois;type</span>. Valeur
-              par défaut pour le `type` : Sortie.
-            </p>
-            <div className="mt-4 space-y-2">
-              <label className="text-sm font-semibold text-slate-700">Importer un relevé PDF (LCL)</label>
-              <input
-                type="file"
-                accept="application/pdf"
-                onChange={handlePdfUpload}
-                className="text-sm text-slate-500"
-              />
-              {importBankStatementsPdf.isLoading && (
-                <p className="text-xs text-slate-500">Analyse du PDF en cours…</p>
-              )}
-              {pdfInfo && <p className="text-xs text-emerald-600">{pdfInfo}</p>}
-            </div>
+      <div className="mx-auto flex w-full max-w-4xl flex-col gap-4">
+        <Card className="space-y-2">
+          <p className="text-xs uppercase tracking-[0.3em] text-slate-400">Relevés bancaires</p>
+          <h2 className="text-2xl font-semibold text-slate-900">Analyse désactivée temporairement</h2>
+          <p className="text-sm text-slate-600">
+            La vue détaillée des relevés est momentanément désactivée le temps de corriger un problème de dépendances
+            React. Vous pouvez revenir au tableau de bord ou recharger après la mise à jour.
+          </p>
+          <div className="flex flex-wrap gap-2">
+            <Button as="a" href="/" variant="brand">
+              Retour dashboard
+            </Button>
           </div>
-          <div className="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
-            <h3 className="text-lg font-semibold text-slate-900 mb-3 flex items-center gap-2">
-              <Filter className="w-4 h-4 text-blue-600" />
-              Moduler les relevés
-            </h3>
-            {editableTransaction ? (
-              <form onSubmit={handleEditSubmit} className="space-y-3">
-                <div className="grid gap-2">
-                  <label className="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Libellé</label>
-                  <input
-                    type="text"
-                    value={editableTransaction.libelle}
-                    onChange={(event) => handleEditChange('libelle', event.target.value)}
-                    className="rounded-2xl border border-slate-200 px-3 py-2 text-sm"
-                  />
-                </div>
-                <div className="grid gap-2">
-                  <label className="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Catégorie</label>
-                  <input
-                    type="text"
-                    value={editableTransaction.categorie}
-                    onChange={(event) => handleEditChange('categorie', event.target.value)}
-                    className="rounded-2xl border border-slate-200 px-3 py-2 text-sm"
-                  />
-                </div>
-                <div className="grid gap-2">
-                  <label className="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Montant</label>
-                  <input
-                    type="number"
-                    step="0.01"
-                    value={editableTransaction.montant}
-                    onChange={(event) => handleEditChange('montant', event.target.value)}
-                    className="rounded-2xl border border-slate-200 px-3 py-2 text-sm"
-                  />
-                </div>
-                <div className="grid gap-2">
-                  <label className="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Type</label>
-                  <select
-                    className="rounded-2xl border border-slate-200 px-3 py-2 text-sm"
-                    value={editableTransaction.type}
-                    onChange={(event) => handleEditChange('type', event.target.value)}
-                  >
-                    <option value="Entrée">Entrée</option>
-                    <option value="Sortie">Sortie</option>
-                  </select>
-                </div>
-                <div className="grid gap-2">
-                  <label className="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Mois</label>
-                  <input
-                    type="text"
-                    value={editableTransaction.mois}
-                    onChange={(event) => handleEditChange('mois', event.target.value)}
-                    className="rounded-2xl border border-slate-200 px-3 py-2 text-sm"
-                  />
-                </div>
-                <div className="flex items-center justify-between">
-                  <button
-                    type="button"
-                    onClick={handleEditCancel}
-                    className="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 hover:text-slate-900"
-                  >
-                    Annuler
-                  </button>
-                  <button
-                    type="submit"
-                    className="rounded-full bg-blue-600 px-4 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-white hover:bg-blue-700"
-                  >
-                    Sauvegarder
-                  </button>
-                </div>
-              </form>
-            ) : (
-              <p className="text-sm text-slate-500">Cliquez sur "Modifier" dans un relevé pour ajuster une ligne.</p>
-            )}
-          </div>
-        </section>
-          </div>
-        </div>
+        </Card>
       </div>
-      {expenseModal && (
-        <div className="fixed inset-0 z-30 flex items-center justify-center bg-slate-900/30 px-4 py-8">
-          <div className="w-full max-w-lg rounded-2xl bg-white p-6 shadow-xl">
-            <div className="flex items-center justify-between mb-4">
-              <h3 className="text-lg font-semibold text-slate-900">Créer une charge depuis le relevé</h3>
-              <button type="button" onClick={handleCloseExpenseModal} className="text-slate-400 hover:text-slate-600 text-sm font-semibold">
-                Fermer
-              </button>
-            </div>
-            <form onSubmit={handleExpenseSubmit} className="space-y-4">
-              <div>
-                <label className="text-xs font-semibold text-slate-500">Libellé</label>
-                <input
-                  type="text"
-                  value={expenseModal.form.libelle}
-                  onChange={(e) => handleExpenseFieldChange('libelle', e.target.value)}
-                  className="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm"
-                />
-              </div>
-              <div className="grid gap-3 md:grid-cols-2">
-                <div>
-                  <label className="text-xs font-semibold text-slate-500">Date</label>
-                  <input
-                    type="date"
-                    value={expenseModal.form.date_operation}
-                    onChange={(e) => handleExpenseFieldChange('date_operation', e.target.value)}
-                    className="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm"
-                  />
-                </div>
-                <div>
-                  <label className="text-xs font-semibold text-slate-500">Montant HT (€)</label>
-                  <input
-                    type="number"
-                    step="0.01"
-                    value={expenseModal.form.montant_ht}
-                    onChange={(e) => handleExpenseFieldChange('montant_ht', e.target.value)}
-                    className="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm"
-                  />
-                </div>
-              </div>
-              <div className="grid gap-3 md:grid-cols-2">
-                <div>
-                  <label className="text-xs font-semibold text-slate-500">Catégorie</label>
-                  <select
-                    value={expenseModal.form.categorie_id || ''}
-                    onChange={(e) => handleExpenseFieldChange('categorie_id', e.target.value ? Number(e.target.value) : null)}
-                    className="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm"
-                  >
-                    <option value="">(Aucune)</option>
-                    {categoryOptions.map((cat) => (
-                      <option key={cat.id} value={cat.id}>
-                        {cat.nom}
-                      </option>
-                    ))}
-                  </select>
-                </div>
-                <div>
-                  <label className="text-xs font-semibold text-slate-500">Centre de coûts</label>
-                  <select
-                    value={expenseModal.form.cost_center_id || ''}
-                    onChange={(e) => handleExpenseFieldChange('cost_center_id', e.target.value ? Number(e.target.value) : null)}
-                    className="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm"
-                  >
-                    <option value="">(Aucun)</option>
-                    {costCenterOptions.map((center) => (
-                      <option key={center.id} value={center.id}>
-                        {center.nom}
-                      </option>
-                    ))}
-                  </select>
-                </div>
-              </div>
-              <div className="grid gap-3 md:grid-cols-2">
-                <div>
-                  <label className="text-xs font-semibold text-slate-500">TVA (%)</label>
-                  <input
-                    type="number"
-                    step="0.1"
-                    value={expenseModal.form.tva_pct}
-                    onChange={(e) => handleExpenseFieldChange('tva_pct', e.target.value ? Number(e.target.value) : 0)}
-                    className="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm"
-                  />
-                </div>
-                <div>
-                  <label className="text-xs font-semibold text-slate-500">Fournisseur</label>
-                  <input
-                    type="number"
-                    min="1"
-                    value={expenseModal.form.fournisseur_id || ''}
-                    onChange={(e) => handleExpenseFieldChange('fournisseur_id', e.target.value ? Number(e.target.value) : null)}
-                    placeholder="ID fournisseur"
-                    className="mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm"
-                  />
-                </div>
-              </div>
-              {expenseError && <p className="text-xs font-semibold text-rose-600">{expenseError}</p>}
-              <div className="flex items-center justify-end gap-2">
-                <button
-                  type="button"
-                  onClick={handleCloseExpenseModal}
-                  className="rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600"
-                >
-                  Annuler
-                </button>
-                <button
-                  type="submit"
-                  disabled={createExpenseFromStatement.isLoading}
-                  className="rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-700 disabled:opacity-50"
-                >
-                  {createExpenseFromStatement.isLoading ? 'Création...' : 'Créer la charge'}
-                </button>
-              </div>
-            </form>
-          </div>
-        </div>
-      )}
     </div>
   );
-};
-
-export default BankStatementAnalyzer;
+}
diff --git a/frontend/src/features/restaurant/RestaurantMenuPage.jsx b/frontend/src/features/restaurant/RestaurantMenuPage.jsx
index b0b2fc4..0e2286b 100644
--- a/frontend/src/features/restaurant/RestaurantMenuPage.jsx
+++ b/frontend/src/features/restaurant/RestaurantMenuPage.jsx
@@ -1,9 +1,6 @@
 import { useMemo, useState } from 'react';
 import Card from '../../components/ui/Card.jsx';
 import Button from '../../components/ui/Button.jsx';
-import Input from '../../components/ui/Input.jsx';
-import Input from '../../components/ui/Input.jsx';
-import Select from '../../components/ui/Select.jsx';
 import {
   useRestaurantIngredients,
   useCreateRestaurantIngredient,
@@ -70,6 +67,24 @@ export default function RestaurantMenuPage() {
     ? (ingredients.data ?? []).find((ing) => ing.id === Number(ingredientUpdate.ingredientId))
     : null;
 
+  const platCategoryOptions = useMemo(
+    () =>
+      Array.from(
+        new Set(
+          (plats.data ?? [])
+            .map((plat) => plat.categorie)
+            .filter((value) => value && value.trim().length > 0),
+        ),
+      ).sort((a, b) => a.localeCompare(b, 'fr', { sensitivity: 'base' })),
+    [plats.data],
+  );
+  const currentCategoryInOptions = platCategoryOptions.includes(platForm.categorie);
+  const selectCategoryValue = currentCategoryInOptions
+    ? platForm.categorie
+    : platForm.categorie
+      ? '__new__'
+      : '';
+
   const ingredientHistoryEntries = ingredientHistory.data ?? [];
   const platHistoryEntries = platHistory.data ?? [];
   const platsByCategory = menuList.reduce((acc, plat) => {
@@ -82,6 +97,9 @@ export default function RestaurantMenuPage() {
   const filteredPlats = menuList
     .filter((plat) => plat.nom.toLowerCase().includes(platFilter.toLowerCase()))
     .filter((plat) => (categoryFilter === 'all' ? true : (plat.categorie || 'Divers') === categoryFilter));
+  const visibleCategories = sortedCategories.filter((category) =>
+    filteredPlats.some((plat) => (plat.categorie || 'Divers') === category),
+  );
   const ingredientList = ingredients.data ?? [];
   const filteredIngredients = ingredientList.filter((ing) =>
     ing.nom.toLowerCase().includes(ingredientFilter.toLowerCase()),
@@ -139,7 +157,7 @@ export default function RestaurantMenuPage() {
           quantite: parseFloat(bomForm.quantite),
           unite: bomForm.unite || undefined,
         },
-        },
+      },
       {
         onSuccess: () => setBomForm({ plat_id: '', ingredient_id: '', quantite: '', unite: '' }),
       },
@@ -182,7 +200,6 @@ export default function RestaurantMenuPage() {
 
   const mappings = useRestaurantPlatMappings();
   const platLinks = mappings.data ?? [];
-  const syncIngredients = useSyncRestaurantIngredients();
 
   return (
     <div className="flex flex-col gap-6">
@@ -407,12 +424,35 @@ export default function RestaurantMenuPage() {
           </div>
           <div className="grid gap-2">
             <label className="text-sm font-semibold text-slate-700">Catégorie</label>
-            <input
-              type="text"
+            <select
               className="rounded-2xl border border-slate-200 px-4 py-3 text-sm"
-              value={platForm.categorie}
-              onChange={(event) => setPlatForm((prev) => ({ ...prev, categorie: event.target.value }))}
-            />
+              value={selectCategoryValue}
+              onChange={(event) => {
+                const value = event.target.value;
+                if (value === '__new__') {
+                  setPlatForm((prev) => ({ ...prev, categorie: prev.categorie || '' }));
+                } else {
+                  setPlatForm((prev) => ({ ...prev, categorie: value }));
+                }
+              }}
+            >
+              <option value="">Non classé</option>
+              {platCategoryOptions.map((category) => (
+                <option key={category} value={category}>
+                  {category}
+                </option>
+              ))}
+              <option value="__new__">Nouvelle catégorie…</option>
+            </select>
+            {selectCategoryValue === '__new__' && (
+              <input
+                type="text"
+                className="mt-2 rounded-2xl border border-dashed border-slate-300 px-4 py-3 text-sm"
+                placeholder="Saisir une nouvelle catégorie"
+                value={platForm.categorie}
+                onChange={(event) => setPlatForm((prev) => ({ ...prev, categorie: event.target.value }))}
+              />
+            )}
           </div>
           <div className="grid gap-2">
             <label className="text-sm font-semibold text-slate-700">Prix TTC (€)</label>
@@ -508,7 +548,8 @@ export default function RestaurantMenuPage() {
               </option>
             ))}
           </select>
-          <Input
+          <input
+            type="text"
             placeholder="Filtrer les ingrédients (optionnel)"
             value={ingredientFilter}
             onChange={(event) => setIngredientFilter(event.target.value)}
@@ -584,63 +625,64 @@ export default function RestaurantMenuPage() {
                   <div>
                     <p className="text-xs uppercase tracking-[0.35em] text-slate-400">Catégorie</p>
                     <h3 className="text-lg font-semibold text-slate-900">{category}</h3>
+                  </div>
+                  <span className="rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">
+                    {platsByCategory[category].length} plat(s)
+                  </span>
                 </div>
-                <span className="rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">
-                  {platsByCategory[category].length} plat(s)
-                </span>
-              </div>
-              <div className="grid gap-3 lg:grid-cols-2">
-                {filteredPlats
-                  .filter((plat) => (plat.categorie || 'Divers') === category)
-                  .sort((a, b) => a.nom.localeCompare(b.nom))
-                  .map((plat) => (
-                    <div key={plat.id} className="rounded-2xl border border-slate-100 p-3">
-                      <div className="flex items-center justify-between">
-                        <div>
-                          <p className="text-lg font-semibold text-slate-900">{plat.nom}</p>
-                          <p className="text-xs text-slate-500">
-                            Marge {plat.marge_pct?.toFixed(1) ?? 'N/C'} % · Coût {plat.cout_matiere?.toFixed(2) ?? '0'} €
-                          </p>
-                        </div>
-                        <div className="text-right">
-                          <p className="text-sm font-semibold text-slate-900">{plat.prix_vente_ttc.toFixed(2)} €</p>
-                          <div className="mt-1 flex gap-2 text-xs text-brand-700">
-                            <Button
-                              variant="ghost"
-                              size="sm"
-                              onClick={() => setPlatUpdate({ platId: plat.id, price: plat.prix_vente_ttc })}
-                            >
-                              MAJ prix
-                            </Button>
-                            <Button variant="ghost" size="sm" onClick={() => setHistoryPlatId(plat.id)}>
-                              Historique
-                            </Button>
+                <div className="grid gap-3 lg:grid-cols-2">
+                  {filteredPlats
+                    .filter((plat) => (plat.categorie || 'Divers') === category)
+                    .sort((a, b) => a.nom.localeCompare(b.nom))
+                    .map((plat) => (
+                      <div key={plat.id} className="rounded-2xl border border-slate-100 p-3">
+                        <div className="flex items-center justify-between">
+                          <div>
+                            <p className="text-lg font-semibold text-slate-900">{plat.nom}</p>
+                            <p className="text-xs text-slate-500">
+                              Marge {plat.marge_pct?.toFixed(1) ?? 'N/C'} % · Coût {plat.cout_matiere?.toFixed(2) ?? '0'} €
+                            </p>
+                          </div>
+                          <div className="text-right">
+                            <p className="text-sm font-semibold text-slate-900">{plat.prix_vente_ttc.toFixed(2)} €</p>
+                            <div className="mt-1 flex gap-2 text-xs text-brand-700">
+                              <Button
+                                variant="ghost"
+                                size="sm"
+                                onClick={() => setPlatUpdate({ platId: plat.id, price: plat.prix_vente_ttc })}
+                              >
+                                MAJ prix
+                              </Button>
+                              <Button variant="ghost" size="sm" onClick={() => setHistoryPlatId(plat.id)}>
+                                Historique
+                              </Button>
+                            </div>
                           </div>
                         </div>
-                      </div>
-                      <table className="mt-3 w-full divide-y divide-slate-100 text-sm">
-                        <thead>
-                          <tr className="text-left text-xs uppercase tracking-widest text-slate-500">
-                            <th className="py-1">Ingrédient</th>
-                            <th className="py-1">Quantité</th>
-                            <th className="py-1">Unité</th>
-                          </tr>
-                        </thead>
-                        <tbody>
-                          {(plat.ingredients ?? []).map((item) => (
-                            <tr key={item.id}>
-                              <td className="py-1 text-slate-900">{item.nom}</td>
-                              <td className="py-1 text-slate-600">{Number(item.quantite).toFixed(3)}</td>
-                              <td className="py-1 text-slate-600">{item.unite || '-'}</td>
+                        <table className="mt-3 w-full divide-y divide-slate-100 text-sm">
+                          <thead>
+                            <tr className="text-left text-xs uppercase tracking-widest text-slate-500">
+                              <th className="py-1">Ingrédient</th>
+                              <th className="py-1">Quantité</th>
+                              <th className="py-1">Unité</th>
                             </tr>
-                          ))}
-                        </tbody>
-                      </table>
-                    </div>
-                  ))}
+                          </thead>
+                          <tbody>
+                            {(plat.ingredients ?? []).map((item) => (
+                              <tr key={item.id}>
+                                <td className="py-1 text-slate-900">{item.nom}</td>
+                                <td className="py-1 text-slate-600">{Number(item.quantite).toFixed(3)}</td>
+                                <td className="py-1 text-slate-600">{item.unite || '-'}</td>
+                              </tr>
+                            ))}
+                          </tbody>
+                        </table>
+                      </div>
+                    ))}
+                </div>
               </div>
-            </div>
-          ))}
+            ))
+          )}
         </div>
       </Card>
 
diff --git a/frontend/src/features/supply/SupplyPage.jsx b/frontend/src/features/supply/SupplyPage.jsx
index ad1173e..3823a5c 100644
--- a/frontend/src/features/supply/SupplyPage.jsx
+++ b/frontend/src/features/supply/SupplyPage.jsx
@@ -104,6 +104,7 @@ export default function SupplyPage() {
   const [filters, setFilters] = useState(defaultFilters);
   const [drawerOpen, setDrawerOpen] = useState(false);
   const [categoriesInitialized, setCategoriesInitialized] = useState(false);
+  const [sortMode, setSortMode] = useState('priority');
   const { data, isLoading, isFetching, isError } = useSupplyPlan(filters);
 
   const plan = data ?? {
@@ -154,6 +155,22 @@ export default function SupplyPage() {
     if (!supplierFocus) return [];
     return plan.items.filter((item) => item.fournisseur === supplierFocus && item.quantite_a_commander > 0);
   }, [plan.items, supplierFocus]);
+  const sortedPlanItems = useMemo(() => {
+    const base = [...(plan.items ?? [])];
+    if (sortMode === 'category') {
+      return base.sort((a, b) => {
+        const catA = (a.categorie || '').toLowerCase();
+        const catB = (b.categorie || '').toLowerCase();
+        const byCat = catA.localeCompare(catB, 'fr', { sensitivity: 'base' });
+        if (byCat !== 0) return byCat;
+        return (a.nom || '').localeCompare(b.nom || '', 'fr', { sensitivity: 'base' });
+      });
+    }
+    if (sortMode === 'name') {
+      return base.sort((a, b) => (a.nom || '').localeCompare(b.nom || '', 'fr', { sensitivity: 'base' }));
+    }
+    return base; // priorité : on conserve l'ordre renvoyé par le plan
+  }, [plan.items, sortMode]);
 
   const handleCategoryToggle = (category) => {
     setFilters((prev) => {
@@ -368,6 +385,20 @@ export default function SupplyPage() {
       {!loadingState && !isError && (
         <>
           <Card className="p-0">
+            <div className="flex items-center justify-end gap-3 px-4 py-3">
+              <label className="text-sm text-slate-600">
+                Tri
+                <select
+                  className="ml-2 rounded-full border border-slate-200 px-3 py-1 text-sm"
+                  value={sortMode}
+                  onChange={(event) => setSortMode(event.target.value)}
+                >
+                  <option value="priority">Priorité (ordre du plan)</option>
+                  <option value="category">Catégorie (A→Z)</option>
+                  <option value="name">Nom (A→Z)</option>
+                </select>
+              </label>
+            </div>
             {plan.items.length === 0 ? (
               <p className="p-6 text-sm text-slate-500">Aucun article ne correspond aux filtres appliqués.</p>
             ) : (
@@ -390,7 +421,7 @@ export default function SupplyPage() {
                     </tr>
                   </thead>
                   <tbody className="divide-y divide-slate-100">
-                    {plan.items.map((item) => (
+                    {sortedPlanItems.map((item) => (
                       <tr key={item.id} className="hover:bg-slate-50/60">
                         <td className="px-4 py-3">
                           <p className="font-medium text-slate-900">{item.nom}</p>
diff --git a/frontend/src/hooks/useInvoiceImport.js b/frontend/src/hooks/useInvoiceImport.js
index 8c3779b..de002e1 100644
--- a/frontend/src/hooks/useInvoiceImport.js
+++ b/frontend/src/hooks/useInvoiceImport.js
@@ -53,7 +53,9 @@ export function useInvoiceHistory(filters = {}) {
   return useQuery({
     queryKey: ['invoice-history', filters],
     queryFn: () => fetchInvoiceHistory(filters),
-    staleTime: 30_000,
-    refetchOnWindowFocus: false,
+    staleTime: 0,
+    cacheTime: 0,
+    refetchOnWindowFocus: true,
+    refetchOnMount: 'always',
   });
 }
diff --git a/frontend/vite.config.js b/frontend/vite.config.js
index 9a68ef9..98a746b 100644
--- a/frontend/vite.config.js
+++ b/frontend/vite.config.js
@@ -1,8 +1,18 @@
 import { defineConfig } from 'vite';
 import react from '@vitejs/plugin-react';
+import path from 'path';
 
 export default defineConfig({
   plugins: [react()],
+  resolve: {
+    dedupe: ['react', 'react-dom'],
+    alias: {
+      react: path.resolve(__dirname, 'node_modules/react'),
+      'react-dom': path.resolve(__dirname, 'node_modules/react-dom'),
+      'react/jsx-runtime': path.resolve(__dirname, 'node_modules/react/jsx-runtime.js'),
+      'react/jsx-dev-runtime': path.resolve(__dirname, 'node_modules/react/jsx-dev-runtime.js'),
+    },
+  },
   server: {
     port: 5173,
     proxy: {
diff --git a/tests/test_invoice_extractor.py b/tests/test_invoice_extractor.py
index 1dfc7b0..d538652 100644
--- a/tests/test_invoice_extractor.py
+++ b/tests/test_invoice_extractor.py
@@ -248,6 +248,37 @@ def test_extract_products_assigns_facture_dates():
     assert list(df["facture_date"]) == ["05-10-2024 08:00", "06-10-2024 09:30"]
 
 
+def test_extract_products_from_eurociel_invoice():
+    raw_text = """
+    N° de Facture
+    Date
+    05/11/25FA20296730
+    Référence    Qté Montant HTPx unitaire *Désignation          Poids *
+    4,000 34,5000 138,00 C07COURBINE Sénégal G&V - IKAGEL 300/500 - 5kg1 20 *
+    1,000 25,5000 25,50 C07MALTA GUINESS (NON ALCOL) 4 X 6 - 33CL8 10
+    C07 505,10 5,5% 27,78
+    """
+
+    df = invoice_extractor.extract_products_from_eurociel_invoice(raw_text, margin_rate=0.4)
+
+    assert len(df) == 2
+    assert set(df["invoice_id"]) == {"FA20296730"}
+    assert set(df["facture_date"]) == {"05/11/25"}
+    assert list(df["nom"]) == [
+        "COURBINE Sénégal G&V - IKAGEL 300/500 - 5kg",
+        "MALTA GUINESS (NON ALCOL) 4 X 6 - 33CL",
+    ]
+    assert list(df["qte_init"]) == [4.0, 1.0]
+    assert list(df["prix_achat"]) == [34.5, 25.5]
+    assert all(df["tva"] == 5.5)
+
+
+def test_detect_invoice_format_eurociel():
+    text = "Bonjour, facture EUROCIEL Garges lès Gonesse"
+    assert invoice_extractor.detect_invoice_format(text) == "eurociel"
+    assert invoice_extractor.detect_invoice_format(text, supplier_hint="eurociel") == "eurociel"
+
+
 def test_invoice_extractor_source_has_no_merge_conflicts():
     source = (_ROOT / "core" / "invoice_extractor.py").read_text(encoding="utf-8")
     assert "<<<<<<<" not in source
